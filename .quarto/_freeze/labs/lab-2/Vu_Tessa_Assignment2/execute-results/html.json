{
  "hash": "6adcda8ecb9d29434c0ed6d7f1a794dd",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Assignment 2: Spatial Analysis and Visualization\"\nsubtitle: \"Healthcare Access and Equity in Pennsylvania\"\nauthor: \"Tessa Vu\"\ndate: 2025-10-14\nformat: \n  html:\n    code-fold: false\n    toc: true\n    toc-location: left\n    theme: lux\n    embed-resources: true\nexecute:\n  warning: false\n  message: false\neditor: \n  markdown: \n    wrap: 72\n---\n\n## Assignment Overview\n\n**Learning Objectives:**\n\n-   Apply spatial operations to answer policy-relevant research\n    questions\n\n-   Integrate census demographic data with spatial analysis\n\n-   Create publication-quality visualizations and maps\n\n-   Work with spatial data from multiple sources\n\n-   Communicate findings effectively for policy audiences\n\n------------------------------------------------------------------------\n\n## Part 1: Healthcare Access for Vulnerable Populations\n\n### Research Question\n\n**Which Pennsylvania counties have the highest proportion of vulnerable\npopulations (elderly + low-income) living far from hospitals?**\n\nYour analysis should identify counties that should be priorities for\nhealthcare investment and policy intervention.\n\n### Required Analysis Steps\n\nComplete the following analysis, documenting each step with code and\nbrief explanations:\n\n#### Step 1: Data Collection (5 points)\n\nLoad the required spatial data:\n\n-   Pennsylvania county boundaries\n\n-   Pennsylvania hospitals (from lecture data)\n\n-   Pennsylvania census tracts\n\n**Your Task:**\n\n\n\n**Questions to answer:**\n\n-   How many hospitals are in your dataset?\n\n    -   223 hospitals.\n\n-   How many census tracts?\n\n    -   3,445 census tracts.\n\n-   What coordinate reference system is each dataset in?\n\n    -   PA county boundaries CRS: GCS WGS 84 (Pseudo-Mercator) / EPSG\n\n        4326. \n\n    -   PA census tracts CRS: PCS NAD 83 / EPSG 4269.\n\n    -   PA hospitals CRS: GCS WGS 84 (Pseudo-Mercator) / EPSG 4326.\n\n------------------------------------------------------------------------\n\n#### Step 2: Get Demographic Data\n\nUse `tidycensus` to download tract-level demographic data for\nPennsylvania.\n\n**Required variables:**\n\n-   Total population\n\n-   Median household income\n\n-   Population 65 years and over (you may need to sum multiple age\n    categories)\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get age demographic data from ACS.\ntract_ages <- get_acs(\n  geography = \"tract\",\n  variables = c(\n    \"B01001_020E\", \"B01001_021E\", \"B01001_022E\",\n    \"B01001_023E\", \"B01001_024E\", \"B01001_025E\",\n    \"B01001_044E\", \"B01001_045E\", \"B01001_046E\",\n    \"B01001_047E\", \"B01001_048E\", \"B01001_049E\"\n  ),\n  state = \"PA\",\n  year = 2023,\n  output = \"wide\"\n)\n # Get population and income data from ACS.\ntract_demographics <- get_acs(\n  geography = \"tract\",\n  variables = c(\n    total_pop = \"B01003_001\",\n    median_income = \"B19013_001\"\n  ),\n  state = \"PA\",\n  year = 2023,\n  output = \"wide\"\n)\n\n# Combine 65+ age estimates.\ntract_demographics$age_65_overE <-\n  tract_ages$B01001_020E + tract_ages$B01001_021E + tract_ages$B01001_022E +\n  tract_ages$B01001_023E + tract_ages$B01001_024E + tract_ages$B01001_025E +\n  tract_ages$B01001_044E + tract_ages$B01001_045E + tract_ages$B01001_046E +\n  tract_ages$B01001_047E + tract_ages$B01001_048E + tract_ages$B01001_049E\n\n# Combine 65+ age MOEs.\ntract_demographics$age_65_overM <-\n  tract_ages$B01001_020M + tract_ages$B01001_021M + tract_ages$B01001_022M +\n  tract_ages$B01001_023M + tract_ages$B01001_024M + tract_ages$B01001_025M +\n  tract_ages$B01001_044M + tract_ages$B01001_045M + tract_ages$B01001_046M +\n  tract_ages$B01001_047M + tract_ages$B01001_048M + tract_ages$B01001_049M\n\n# Remove unneeded column.\ntract_demographics$TRACT <- NULL\n\n# Rename tract column.\ntract_demographics <- rename(tract_demographics, TRACT = NAME)\n\n# Join to tract boundaries\npa_tracts <- left_join(pa_tracts, tract_demographics, by = \"GEOID\")\n\n# Summary statistics for reference.\n#summary(pa_tracts[c(\"total_popE\", \"total_popM\",\n#                    \"median_incomeE\", \"median_incomeM\",\n#                    \"age_65_overE\", \"age_65_overM\")])\n```\n:::\n\n\n**Questions to answer:**\n\n-   What year of ACS data are you using?\n\n    -   2023 ACS data.\n\n-   How many tracts have missing income data?\n\n    -   65 tracts are missing income estimates and 73 tracts are missing\n        income MOEs.\n\n-   What is the median income across all PA census tracts?\n\n    -   \\$72,944.\n\n------------------------------------------------------------------------\n\n#### Step 3: Define Vulnerable Populations\n\nIdentify census tracts with vulnerable populations based on TWO\ncriteria:\n\n1.  Low median household income (choose an appropriate threshold)\n\n2.  Significant elderly population (choose an appropriate threshold)\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter for vulnerable tracts.\n# Normalize elderly population.\npa_tracts$pct_elderly <- (pa_tracts$age_65_overE / pa_tracts$total_popE) * 100\n\n# Determine criteria for vulnerable tracts.\npa_tracts <- pa_tracts %>%\n  mutate(\n    # Low income for individuals making $43,700 or less.\n    low_income = case_when(median_incomeE <= 43700 ~ TRUE,\n                           median_incomeE > 43700 ~ FALSE),\n    # High elderly percent when tracts are above the 3rd quartile.\n    high_elderly = case_when(pct_elderly >= 23.51 ~ TRUE,\n                             pct_elderly < 23.51 ~ FALSE),\n    # Considered vulnerable when either of the above cases are true.\n    vulnerable = case_when(low_income == TRUE | high_elderly == TRUE ~ TRUE,\n                           low_income == FALSE & high_elderly == FALSE ~ FALSE)\n  )\n\n# Create a summary for personal reference on vulnerable statistics.\nvulnerable_summary <- pa_tracts %>%\n  group_by(vulnerable) %>%\n  summarize(\n    \"Number of Tracts\" = n(),\n    \"Median Income\" = median(median_incomeE, na.rm = TRUE),\n    \"Percent Elderly\" = median(pct_elderly, na.rm = TRUE),\n    \"Percent Vulnerable\" = (n() / 3445) * 100\n  )\n\n# Remove geometry column for kable table.\nvulnerable_summary$geometry <- NULL\n\n# Create professional table.\nkable(\n  vulnerable_summary,\n  col.names = c(\"Vulnerable\", \"Number of Tracts\", \"Median Income\", \"Percent Elderly\", \"Percent Vulnerable\"),\n  digit = 2,\n  caption = \"<b>PENNSYLVANIA: VULNERABLE TRACTS</b>\"\n) %>%\n  kable_styling(latex_options = \"striped\") %>%\n  column_spec(1, bold = TRUE) %>%\n  row_spec(0, color = \"white\", background = \"black\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table\" style=\"margin-left: auto; margin-right: auto;\">\n<caption><b>PENNSYLVANIA: VULNERABLE TRACTS</b></caption>\n <thead>\n  <tr>\n   <th style=\"text-align:left;color: white !important;background-color: black !important;\"> Vulnerable </th>\n   <th style=\"text-align:right;color: white !important;background-color: black !important;\"> Number of Tracts </th>\n   <th style=\"text-align:right;color: white !important;background-color: black !important;\"> Median Income </th>\n   <th style=\"text-align:right;color: white !important;background-color: black !important;\"> Percent Elderly </th>\n   <th style=\"text-align:right;color: white !important;background-color: black !important;\"> Percent Vulnerable </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> FALSE </td>\n   <td style=\"text-align:right;\"> 2233 </td>\n   <td style=\"text-align:right;\"> 77838 </td>\n   <td style=\"text-align:right;\"> 17.50 </td>\n   <td style=\"text-align:right;\"> 64.82 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> TRUE </td>\n   <td style=\"text-align:right;\"> 1152 </td>\n   <td style=\"text-align:right;\"> 64676 </td>\n   <td style=\"text-align:right;\"> 25.43 </td>\n   <td style=\"text-align:right;\"> 33.44 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;font-weight: bold;\"> NA </td>\n   <td style=\"text-align:right;\"> 60 </td>\n   <td style=\"text-align:right;\"> NA </td>\n   <td style=\"text-align:right;\"> 2.96 </td>\n   <td style=\"text-align:right;\"> 1.74 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n**Questions to answer:**\n\n-   What income threshold did you choose and why?\n\n    -   \\$43,700 was the income threshold I chose based off of a [2023\n        paper published by the U.S. Department of Housing and Urban\n        Development’s Office of Policy Development and\n        Research](https://www.huduser.gov/portal/datasets/home-datasets/files/HOME_IncomeLmts_State_PA_2023.pdf)\n        with a list of PA counties and low income estimates commensurate\n        with the area and number of individuals in a household. I took\n        the median of all the estimates for the different counties.\n\n-   What elderly population threshold did you choose and why?\n\n    -   I used 23.51% as the threshold because that's the third quartile\n        for the elderly population percentage in PA.\n\n-   How many tracts meet your vulnerability criteria?\n\n    -   1,152 tracts meet the vulnerability criteria.\n\n-   What percentage of PA census tracts are considered vulnerable by\n    your definition?\n\n    -   Approximately 33.44% of PA's census tracts are considered\n        vulnerable.\n\n------------------------------------------------------------------------\n\n#### Step 4: Calculate Distance to Hospitals\n\nFor each vulnerable tract, calculate the distance to the nearest\nhospital.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter PA tracts by vulnerability.\nvulnerable_tracts <- pa_tracts %>%\n  filter(vulnerable == TRUE)\n\n# Transform to appropriate projected CRS.\nvulnerable_tracts <- st_transform(vulnerable_tracts, crs = 5070)\npa_tracts <- st_transform(pa_tracts, crs = 5070)\npa_hospitals <- st_transform(pa_hospitals, crs = 5070)\n\n# Calculate distance from each tract centroid to nearest hospital.\n# Create vulnerable tract centroids.\nvulnerable_centroids <- st_centroid(vulnerable_tracts)\n\n# Create a list of indexes of hospitals closest to vulnerable centroids\nnearest_hospital_index <- st_nearest_feature(vulnerable_centroids, pa_hospitals)\n\n# Create points from the hospital index.\nnearest_hospital_point <- pa_hospitals[nearest_hospital_index,]\n\n# Calculate distance between centroid and nearest hospital.\nhospital_distance <- st_distance(vulnerable_centroids, nearest_hospital_point, by_element = TRUE)\n\n# Set miles units.\nvulnerable_tracts$nearest_hospital_mi <- set_units(hospital_distance, \"mi\")\n\n# Summary statistics for reference.\n#summary(vulnerable_tracts[c(\"total_popE\", \"total_popM\",\n#                            \"median_incomeE\", \"median_incomeM\",\n#                            \"age_65_overE\", \"age_65_overM\",\n#                            \"pct_elderly\", \"low_income\",\n#                            \"high_elderly\", \"vulnerable\")])\n\n# Determine how many tracts have hospitals more than 10 miles away.\nunderserved_number <- sum(vulnerable_tracts$nearest_hospital_mi > set_units(15, \"mi\"))\n\nprint(paste0(\"There are \", underserved_number, \" census tracts that are underserved.\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"There are 34 census tracts that are underserved.\"\n```\n\n\n:::\n:::\n\n\n**Requirements:**\n\n-   Use an appropriate projected coordinate system for Pennsylvania\n\n-   Calculate distances in miles\n\n-   Explain why you chose your projection\n\n    -   I chose Albers Equal Area because it was appropriate when\n        calculating hospital distances all over the state, if I'd chosen\n        a PCS that was more localized like State Planes, then depending\n        whichever cardinal direction I selected (i.e. North or South\n        Pennsylvania), it'd have some distortion in other regions of\n        Pennsylvania.\n\n**Questions to answer:**\n\n-   What is the average distance to the nearest hospital for vulnerable\n    tracts?\n\n    -   4.35816 miles.\n\n-   What is the maximum distance?\n\n    -   28.98276 miles.\n\n-   How many vulnerable tracts are more than 15 miles from the nearest\n    hospital?\n\n    -   34 census tracts of the 1,152 total vulnerable tracts are more\n        than 15 miles from the nearest hospital.\n\n------------------------------------------------------------------------\n\n#### Step 5: Identify Underserved Areas\n\nDefine \"underserved\" as vulnerable tracts that are more than 15 miles\nfrom the nearest hospital.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Filter tracts with hospitals more than 15 miles away.\nunderserved_tracts <- vulnerable_tracts %>%\n  filter(nearest_hospital_mi > set_units(15, \"mi\"))\n\n# Create underserved column when hospitals are more than 15 miles away.\nvulnerable_tracts <- vulnerable_tracts %>% mutate(\n  underserved = case_when(\n    vulnerable_tracts$nearest_hospital_mi > set_units(15, \"mi\") ~ TRUE,\n    TRUE ~ FALSE))\n\n# Calculate percent of underserved tracts by dividing it with vulnerable tracts.\nunderserved_percent <- (nrow(underserved_tracts) / nrow(vulnerable_tracts)) * 100\n\nprint(sprintf(\"%.2f%% of vulnerable census tracts are underserved.\", underserved_percent))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2.95% of vulnerable census tracts are underserved.\"\n```\n\n\n:::\n:::\n\n\n**Questions to answer:**\n\n-   How many tracts are underserved?\n\n    -   34 census tracts are underserved.\n\n-   What percentage of vulnerable tracts are underserved?\n\n    -   2.95% of vulnerable census tracts are underserved.\n\n-   Does this surprise you? Why or why not?\n\n    -   Not quite. I'm from Utah and the disparity with hospital access\n        is expected, especially since it's twice the size of\n        Pennsylvania. I know in the US' East Coast I expect that the\n        states have better hospital coverage given that they were also\n        established as states over a century earlier than Utah, so\n        they've had that time to construct more expansive infrastructure\n        compared. That being said, it's still important to address the\n        lacking access of those who are underserved, even if it seems\n        like a small percent of the population.\n\n------------------------------------------------------------------------\n\n#### Step 6: Aggregate to County Level\n\nUse spatial joins and aggregation to calculate county-level statistics\nabout vulnerable populations and hospital access.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Spatial join tracts to counties.\n# Remove the \" County\" substring from the NAMELSADCO column values.\nvulnerable_tracts <- vulnerable_tracts %>%\n  mutate(NAMELSADCO = str_remove_all(NAMELSADCO, \" County\"))\n\n# Change the values in NAMELSADCO to all capitalized for later joining.\nvulnerable_tracts$NAMELSADCO <- toupper(vulnerable_tracts$NAMELSADCO)\n\n# Align CRS of both data before spatial join.\nvulnerable_tracts <- st_transform(vulnerable_tracts, crs = 4326)\npa_counties <- st_transform(pa_counties, crs = 4326)\n\n# Spatial left join.\ncounty_tracts <- st_join(vulnerable_tracts, pa_counties, left = TRUE)\n\n# Aggregate statistics by county\naggregate_summary <- county_tracts %>%\n  st_drop_geometry() %>% # Drop the geometry.\n  group_by(NAMELSADCO) %>% # Group by county.\n  summarize(\n    # Summarize the number of vulnerable and underserved people.\n    number_vulnerable = sum(vulnerable),\n    number_underserved = sum(underserved),\n    # Summarize the percent of underserved people.\n    percent_underserved = (number_underserved / number_vulnerable) * 100,\n    # Summarize the average distance to the nearest hospital.\n    avg_nearby_hospital_dist = mean(nearest_hospital_mi),\n    # Summarize the total estimated population.\n    total_vulnerable_pop = sum(total_popE)\n  ) %>%\n  # Rename the NAMELSADCO column to county.\n  rename(\n    county = NAMELSADCO\n  )\n\n# Change COUNTY_NAM to county.\npa_counties <- rename(pa_counties, county = COUNTY_NAM)\n\n# Conduct a left join.\npa_mapping <- left_join(pa_counties, aggregate_summary, by = \"county\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Plot map of percent underserved by Pennsylvania counties.\nggplot(pa_mapping) +\n  geom_sf(aes(fill = percent_underserved), color = \"white\", size = 0.5) +\n  scale_fill_viridis_c(\n    name = \"Percent Underserved\",\n    option = \"magma\",\n    # Format to show percent sign on color bar.\n    labels = function(x) paste0(x, \"%\")\n  ) +\n  labs(\n    title = \"Most Underserved Counties\",\n    subtitle = \"Pennsylvania, United States\",\n    caption = \"Source: ACS 2019–2023\"\n  ) +\n  theme_void()\n```\n\n::: {.cell-output-display}\n![](Vu_Tessa_Assignment2_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n\n**Required county-level statistics:**\n\n-   Number of vulnerable tracts\n\n-   Number of underserved tracts\n\n-   Percentage of vulnerable tracts that are underserved\n\n-   Average distance to nearest hospital for vulnerable tracts\n\n-   Total vulnerable population\n\n**Questions to answer:**\n\n-   Which 5 counties have the highest percentage of underserved\n    vulnerable tracts?\n\n    -   Cameron (100%), Forest (100%), Sullivan (100%), Union (66.67%),\n        and Clearfield (61.54%) counties.\n\n-   Which counties have the most vulnerable people living far from\n    hospitals?\n\n    -   Counties with an average hospital distance of more than 15 miles\n        and with the most vulnerable people in that group are Sullivan,\n        Cameron, Forest, and Pike.\n\n-   Are there any patterns in where underserved counties are located?\n\n    -   It looks like more of the underserved counties are in the\n        northern portion of Pennsylvania, and seemingly clustered toward\n        the middle in addition. I also know those areas are peppered\n        with several forested regions like national and state forests.\n        Development may be much more restricted due to that.\n\n------------------------------------------------------------------------\n\n#### Step 7: Create Summary Table\n\nCreate a professional table showing the top 10 priority counties for\nhealthcare investment.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create and format priority counties table.\nkable_table <- pa_mapping[, c(\"county\", \"number_vulnerable\",\n                                \"number_underserved\", \"percent_underserved\",\n                                \"avg_nearby_hospital_dist\", \"total_vulnerable_pop\")]\n\n# Drop units to avoid object error when putting in kable.\nkable_table <- kable_table %>%\n  mutate(\n    avg_nearby_hospital_dist = drop_units(avg_nearby_hospital_dist)\n  )\n\n# Drop geometry and rename the columns.\nkable_table <- kable_table %>%\n  st_drop_geometry() %>%\n  rename(\n    \"County\" = county,\n    \"Number of Vulnerable Tracts\" = number_vulnerable,\n    \"Number of Underserved Tracts\" = number_underserved,\n    \"Percent Underserved\" = percent_underserved,\n    \"Average Mile(s) to Nearest Hospital\" = avg_nearby_hospital_dist,\n    \"Total Vulnerable People\" = total_vulnerable_pop\n  )\n\n# Filter and arrage the top 10 underserved counties by percent.\nkable_table <- kable_table %>%\n  arrange(desc(`Percent Underserved`)) %>%\n  slice(1:10)\n\n# Format percent column to have % sign.\nkable_table <- kable_table %>%\n  mutate(\n    # Format so percent and distance values have units.\n    `Percent Underserved` = paste0(round(`Percent Underserved`, 2), \"%\"),\n    `Average Mile(s) to Nearest Hospital` = paste0(round(`Average Mile(s) to Nearest Hospital`, 2), \" mi\")\n  )\n\n# Create kable.\nkable(\n  kable_table,\n  # Center align.\n  align = \"c\",\n  # Limit percents to two decimal places.\n  digit = 2,\n  # Make sure numbers are separated by thousands places.\n  format.args = list(big.mark = \",\"),\n  caption = \"<b>TOP 10 UNDERSERVED PA COUNTIES: For Priority Healthcare Investment</b>\"\n) %>%\n  # Shade every other row for ease of reading.\n  kable_styling(bootstrap_options = \"striped\") %>%\n  column_spec(1, bold = TRUE) %>%\n  row_spec(0, color = \"mistyrose\", background = \"red3\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"margin-left: auto; margin-right: auto;\">\n<caption><b>TOP 10 UNDERSERVED PA COUNTIES: For Priority Healthcare Investment</b></caption>\n <thead>\n  <tr>\n   <th style=\"text-align:center;color: mistyrose !important;background-color: rgba(205, 0, 0, 255) !important;\"> County </th>\n   <th style=\"text-align:center;color: mistyrose !important;background-color: rgba(205, 0, 0, 255) !important;\"> Number of Vulnerable Tracts </th>\n   <th style=\"text-align:center;color: mistyrose !important;background-color: rgba(205, 0, 0, 255) !important;\"> Number of Underserved Tracts </th>\n   <th style=\"text-align:center;color: mistyrose !important;background-color: rgba(205, 0, 0, 255) !important;\"> Percent Underserved </th>\n   <th style=\"text-align:center;color: mistyrose !important;background-color: rgba(205, 0, 0, 255) !important;\"> Average Mile(s) to Nearest Hospital </th>\n   <th style=\"text-align:center;color: mistyrose !important;background-color: rgba(205, 0, 0, 255) !important;\"> Total Vulnerable People </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> SULLIVAN </td>\n   <td style=\"text-align:center;\"> 12 </td>\n   <td style=\"text-align:center;\"> 12 </td>\n   <td style=\"text-align:center;\"> 100% </td>\n   <td style=\"text-align:center;\"> 21.76 mi </td>\n   <td style=\"text-align:center;\"> 16,475 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> CAMERON </td>\n   <td style=\"text-align:center;\"> 7 </td>\n   <td style=\"text-align:center;\"> 7 </td>\n   <td style=\"text-align:center;\"> 100% </td>\n   <td style=\"text-align:center;\"> 19.2 mi </td>\n   <td style=\"text-align:center;\"> 16,825 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> FOREST </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 100% </td>\n   <td style=\"text-align:center;\"> 18.04 mi </td>\n   <td style=\"text-align:center;\"> 10,292 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> UNION </td>\n   <td style=\"text-align:center;\"> 6 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 66.67% </td>\n   <td style=\"text-align:center;\"> 13.42 mi </td>\n   <td style=\"text-align:center;\"> 17,183 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> CLEARFIELD </td>\n   <td style=\"text-align:center;\"> 13 </td>\n   <td style=\"text-align:center;\"> 8 </td>\n   <td style=\"text-align:center;\"> 61.54% </td>\n   <td style=\"text-align:center;\"> 14.11 mi </td>\n   <td style=\"text-align:center;\"> 49,002 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> PIKE </td>\n   <td style=\"text-align:center;\"> 17 </td>\n   <td style=\"text-align:center;\"> 8 </td>\n   <td style=\"text-align:center;\"> 47.06% </td>\n   <td style=\"text-align:center;\"> 15.81 mi </td>\n   <td style=\"text-align:center;\"> 26,997 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> POTTER </td>\n   <td style=\"text-align:center;\"> 8 </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 37.5% </td>\n   <td style=\"text-align:center;\"> 11.36 mi </td>\n   <td style=\"text-align:center;\"> 16,317 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> BRADFORD </td>\n   <td style=\"text-align:center;\"> 3 </td>\n   <td style=\"text-align:center;\"> 1 </td>\n   <td style=\"text-align:center;\"> 33.33% </td>\n   <td style=\"text-align:center;\"> 13.12 mi </td>\n   <td style=\"text-align:center;\"> 13,217 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> LYCOMING </td>\n   <td style=\"text-align:center;\"> 13 </td>\n   <td style=\"text-align:center;\"> 4 </td>\n   <td style=\"text-align:center;\"> 30.77% </td>\n   <td style=\"text-align:center;\"> 8.31 mi </td>\n   <td style=\"text-align:center;\"> 35,545 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> MONROE </td>\n   <td style=\"text-align:center;\"> 17 </td>\n   <td style=\"text-align:center;\"> 5 </td>\n   <td style=\"text-align:center;\"> 29.41% </td>\n   <td style=\"text-align:center;\"> 11.27 mi </td>\n   <td style=\"text-align:center;\"> 50,699 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n**Requirements:**\n\n-   Use `knitr::kable()` or similar for formatting\n\n-   Include descriptive column names\n\n-   Format numbers appropriately (commas for population, percentages,\n    etc.)\n\n-   Add an informative caption\n\n-   Sort by priority (you decide the metric)\n\n------------------------------------------------------------------------\n\n## Part 2: Comprehensive Visualization\n\nUsing the skills from Week 3 (Data Visualization), create\npublication-quality maps and charts.\n\n### Map 1: County-Level Choropleth\n\nCreate a choropleth map showing healthcare access challenges at the\ncounty level.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create county-level access map.\n# Align CRS.\npa_hospitals <- st_transform(pa_hospitals, crs = 4326)\npa_mapping <- st_transform(pa_mapping, crs = 4326)\n\n# Choropleth map of PA counties.\nchoropleth_pa <- ggplot(pa_mapping) +\n  geom_sf(\n    # Color by underserved percentage.\n    aes(fill = percent_underserved),\n    color = \"white\",\n    linewidth = 0.25\n  ) +\n  scale_fill_viridis_c(\n    # Color bar customization.\n    name = \"Percent Underserved\",\n    option = \"viridis\",\n    # Format to show percent sign in color bar.\n    labels = function(x) paste0(x, \"%\")\n  ) +\n  geom_point(\n    data = pa_hospitals,\n    aes(x = LONGITUDE, y = LATITUDE, color = \"Hospitals\"),\n    alpha = 0.75, inherit.aes = FALSE\n  ) +\n  scale_color_manual(\n    name = \"Hospitals\",\n    values = c(\"Hospitals\" = \"red\")\n  ) +\n  labs(\n    title = \"UNDERSERVED COUNTIES & HOSPITAL LOCATIONS\",\n    subtitle = \"Pennsylvania, United States\",\n    caption = \"Source: 5-Year American Community Survey (ACS) 2019–2023\",\n  ) +\n  theme_void()\n\nchoropleth_pa + theme(\n  legend.box.margin = margin(l = 10, unit = \"pt\"),\n  legend.title = element_text(face = \"bold\"),\n  legend.text = element_text(family = \"mono\"),\n  plot.title = element_text(face = \"bold\"),\n  plot.subtitle = element_text(margin = margin(b = 10, t = 5, unit = \"pt\")),\n  plot.caption = element_text(margin = margin(t = 10, unit = \"pt\"), face = \"italic\", family = \"mono\")\n)\n```\n\n::: {.cell-output-display}\n![](Vu_Tessa_Assignment2_files/figure-html/unnamed-chunk-9-1.png){width=2400}\n:::\n:::\n\n\n**Requirements:**\n\n-   Fill counties by percentage of vulnerable tracts that are\n    underserved\n\n-   Include hospital locations as points\n\n-   Use an appropriate color scheme\n\n-   Include clear title, subtitle, and caption\n\n-   Use `theme_void()` or similar clean theme\n\n-   Add a legend with formatted labels\n\n------------------------------------------------------------------------\n\n### Map 2: Detailed Vulnerability Map\n\nCreate a map highlighting underserved vulnerable tracts.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create detailed tract-level map.\n# Align CRS.\nvulnerable_tracts <- st_transform(vulnerable_tracts, crs = 4326)\npa_tracts <- st_transform(pa_tracts, crs = 4326)\n\n# Filter by underserved tracts.\nvulnerable_tracts <- vulnerable_tracts %>%\n  rename(\"Underserved Tracts\" = underserved)\n\n# Choropleth map of PA census tracts colored by vulnerable and underserved.\nchoropleth_map <- ggplot(vulnerable_tracts) +\n  geom_sf(\n    aes(fill = `Underserved Tracts`),\n  ) +\n  geom_sf(\n    data = pa_tracts, fill = NA,\n    color = \"midnightblue\", linewidth = 0.25\n  ) +\n  geom_sf(\n    data = pa_counties, fill = NA,\n    color = \"midnightblue\", linewidth = 0.5\n  ) +\n  geom_point(\n    data = pa_hospitals,\n    aes(x = LONGITUDE, y = LATITUDE, color = \"Hospitals\"),\n    alpha = 0.75, inherit.aes = FALSE\n  ) +\n  scale_fill_manual(\n    # Custom color bar.\n    name = \"Tracts\",\n    values = c(\"TRUE\" = \"gold2\", \"FALSE\" = \"lemonchiffon2\"),\n    labels = c(\"TRUE\" = \"Underserved\", \"FALSE\" = \"Vulnerable\"),\n    # Reorder so that underserved is placed above vulnerable in the legend.\n    breaks = c(TRUE, FALSE)\n  ) +\n  scale_color_manual(\n    # Custom point addition to legend.\n    name = \"Hospitals\",\n    values = c(\"Hospitals\" = \"red2\")\n  ) +\n  labs(\n    title = \"UNDERSERVED AND VULNERABLE CENSUS TRACTS\",\n    subtitle = \"With Hospital Locations in Pennsylvania, United States\",\n    caption = \"Source: 5-Year American Community Survey (ACS) 2019–2023\",\n  ) +\n  theme_void()\n\nchoropleth_map + theme(\n  panel.background = element_rect(fill = \"azure3\", size = 0.75),\n  legend.box.margin = margin(l = 10, unit = \"pt\"),\n  legend.title = element_text(face = \"bold\"),\n  legend.text = element_text(family = \"mono\"),\n  plot.title = element_text(face = \"bold\"),\n  plot.subtitle = element_text(margin = margin(b = 10, t = 5, unit = \"pt\")),\n  plot.caption = element_text(margin = margin(t = 10, unit = \"pt\"), face = \"italic\", family = \"mono\")\n)\n```\n\n::: {.cell-output-display}\n![](Vu_Tessa_Assignment2_files/figure-html/unnamed-chunk-10-1.png){width=2400}\n:::\n:::\n\n\n**Requirements:**\n\n-   Show underserved vulnerable tracts in a contrasting color\n\n-   Include county boundaries for context\n\n-   Show hospital locations\n\n-   Use appropriate visual hierarchy (what should stand out?)\n\n-   Include informative title and subtitle\n\n------------------------------------------------------------------------\n\n### Chart: Distribution Analysis\n\nCreate a visualization showing the distribution of distances to\nhospitals for vulnerable populations.\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create distribution visualization.\n# Drop mile units to avoid object error in histogram.\nvulnerable_tracts$nearest_hospital_mi <- drop_units(vulnerable_tracts$nearest_hospital_mi)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Make histogram of natural log of distance to nearest hospital.\n# Original histogram is highly right-skewed.\nhistogram_hospital_log <- ggplot(vulnerable_tracts, aes(x = log(nearest_hospital_mi))) +\n  geom_histogram(\n    color = \"black\",\n    fill = \"mistyrose2\"\n  ) +\n  labs(\n    title = \"LN(DISTANCE TO NEAREST HOSPITAL)\",\n    subtitle = \"Histogram\",\n    x = \"Natural Log of Distance to Nearest Hospital\",\n    y = \"Count\") +\n  theme_minimal() +\n  theme(aspect.ratio = 1/3) # Maintain aspect ratio.\n\n# Make histogram of elderly population.\nhistogram_elderly <- ggplot(vulnerable_tracts, aes(x = age_65_overE)) +\n  geom_histogram(\n    color = \"black\",\n    fill = \"mistyrose2\"\n  ) +\n  # Thousand separator.\n  scale_x_continuous(labels = comma) +\n  labs(\n    title = \"VULNERABLE POPULATION OF AGES 65+\",\n    subtitle = \"Histogram\",\n    x = \"Population of Ages 65+\",\n    y = \"Count\") +\n  theme_minimal() +\n  theme(aspect.ratio = 1/3) # Maintain aspect ratio.\n\n# Make scatter plot of elderly population and natural log of hospital distance.\nscatter_plot <- ggplot(vulnerable_tracts, aes(x = log(nearest_hospital_mi), y = age_65_overE)) + \n  geom_point(\n    # Make points less opaque to show visual density.\n    aes(alpha = 0.5)) +\n  geom_smooth(\n    # Add regression line.\n    method = lm, linetype = \"dashed\",\n    # Complementary colors for regression line and confidence shading.\n    color = \"red2\", fill = \"palegreen3\") +\n    # Thousand separator.\n    scale_y_continuous(labels = comma) +\n  labs(\n    title = \"HOSPITAL DISTANCE AND VULNERABLE POPULATION\",\n    subtitle = \"ln(Distance to Nearest Hospital) vs. Population of Ages 65+\",\n    caption = \"Source: 5-Year American Community Survey (ACS) 2019–2023\",\n    x = \"Natural Log of Distance to Nearest Hospital\",\n    y = \"Population of Ages 65+\") +\n  theme(aspect.ratio = 4/3) + # Maintain aspect ratio.\n  guides(alpha = \"none\") # Remove alpha in legend.\n\n# Create faceted plot of all three charts above in one column and three rows.\nfaceted_plot <-\n  (histogram_hospital_log + theme(\n    # Customize margins and text.\n    plot.title = element_text(margin = margin(b = 10, unit = \"pt\"), face = \"bold\"),\n    axis.title.x = element_text(margin = margin(t = 10, unit = \"pt\")),\n    axis.title.y = element_text(margin = margin(r = 10, unit = \"pt\"))\n  )) /\n  (histogram_elderly + theme(\n    # Customize margins and text.\n    plot.title = element_text(margin = margin(t = 20, b = 10, unit = \"pt\"), face = \"bold\"),\n    axis.title.x = element_text(margin = margin(t = 10, unit = \"pt\")),\n    axis.title.y = element_text(margin = margin(r = 10, unit = \"pt\"))\n  )) /\n  (scatter_plot + theme(\n    # Customize margins and text.\n  legend.box.margin = margin(l = 20, unit = \"pt\"),\n  legend.title = element_text(face = \"bold\"),\n  legend.text = element_text(family = \"mono\"),\n  plot.title = element_text(margin = margin(t = 20, unit = \"pt\"), face = \"bold\"),\n  plot.subtitle = element_text(margin = margin(b = 10, t = 5, unit = \"pt\")),\n  plot.caption = element_text(margin = margin(t = 10, unit = \"pt\"), face = \"italic\", family = \"mono\"),\n  axis.title.x = element_text(margin = margin(t = 10, unit = \"pt\")),\n  axis.title.y = element_text(margin = margin(r = 10, unit = \"pt\"))\n  )) +\n  plot_layout(heights = c(1, 1, 2))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Display faceted plot.\n# Axis label units not needed because axes data are dimensionless or are counts.\nfaceted_plot\n```\n\n::: {.cell-output-display}\n![](Vu_Tessa_Assignment2_files/figure-html/unnamed-chunk-13-1.png){width=2400}\n:::\n:::\n\n\n**Suggested chart types:**\n\n-   Histogram or density plot of distances\n\n-   Box plot comparing distances across regions\n\n-   Bar chart of underserved tracts by county\n\n-   Scatter plot of distance vs. vulnerable population size\n\n**Requirements:**\n\n-   Clear axes labels with units\n\n-   Appropriate title\n\n-   Professional formatting\n\n-   Brief interpretation (1-2 sentences as a caption or in text)\n\n    -   There's an upward regression line that seems to communicate a\n        positive correlation between distance to the nearest hospital\n        and the vulnerable population. However, a more in-depth\n        statistical analysis will be needed to determine any\n        significance, especially since the vast majority of points have\n        large variance from the regression line. The natural log of the\n        distance histogram was calculated due to the original data being\n        highly right-skewed.\n\n------------------------------------------------------------------------\n\n## Part 3: Bring Your Own Data Analysis\n\nChoose your own additional spatial dataset and conduct a supplementary\nanalysis.\n\n### Your Analysis\n\n**Your Task:**\n\n1.  **Find and load additional data**\n    -   Document your data source\n    -   Check and standardize the CRS\n    -   Provide basic summary statistics\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# CRS checks and transformations.\n\n# WGS84 / Pseudo-Mercator (EPSG 3857).\n#st_crs(sharps_boxes)\n\n# WGS84 / World Geodetic System 1984 (EPSG 4326).\n#st_crs(treatment_facilities)\n\n# WGS84 / Pseudo-Mercator (EPSG 3857).\n#st_crs(free_meal_sites)\n\n# No CRS. Not a geodataframe. Data has latitude and longitude.\n#st_crs(crime_2024)\n\n# WGS84 / World Geodetic System 1984 (EPSG 4326).\n#st_crs(philly_county)\n\n# WGS84 / World Geodetic System 1984 (EPSG 4326).\n#st_crs(philly_tracts)\n\n# Change data CRS to Pennsylvania South (EPSG 3365) for calculations.\nsharps_boxes <- sharps_boxes %>%\n  st_transform(crs = 3365)\ntreatment_facilities <- treatment_facilities %>%\n  st_transform(crs = 3365)\nfree_meal_sites <- free_meal_sites %>%\n  st_transform(crs = 3365)\nphilly_county <- philly_county %>%\n  st_transform(crs = 3365)\nphilly_tracts <- philly_tracts %>%\n  st_transform(crs = 3365)\n\n# Check CRS changes.\n#st_crs(sharps_boxes)\n#st_crs(treatment_facilities)\n#st_crs(free_meal_sites)\n#st_crs(philly_county)\n#st_crs(philly_tracts)\n\ncrime_2024 <- crime_2024 %>%\n  # Remove points where latitude and longitude are NA or empty.\n  .[!(is.na(.$lng) | .$lng == \"\" | is.na(.$lat) | .$lat == \"\"),] %>%\n  # Change to spatial dataframe and set CRS to 4326 because of coordinate data.\n  st_as_sf(., coords = c(\"lng\", \"lat\"), crs = 4326) %>%\n  # Change to needed CRS for calculations.\n  st_transform(crs = 3365)\n\n# Check CRS change.\n#st_crs(crime_2024)\n\n# Filter 2024 crime data by drug-related crimes.\ndrugs_2024 <- crime_2024 %>%\n  filter(`text_general_code` == \"Narcotic / Drug Law Violations\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Clean data, filter, and remove unneeded columns.\n\nsharps_boxes[, c(\"OBJECTID\", \"OBJECTID_1\", \"SITE_NAME\", \"SUB_NAME\", \"STATE\")] <- list(NULL)\n\n# Filter to Philadelphia\ntreatment_facilities <- treatment_facilities %>%\n  filter(`COUNTY` == \"PHILADELPHIA\")\ntreatment_facilities[, c(\"OBJECTID\", \"FACILITY_I\", \"GEOCODING_\", \"STREET_2\", \"CITY\", \"STATE\", \"TELEPHONE_\")] <- list(NULL)\n\n# Filter to active sites.\nfree_meal_sites <- free_meal_sites %>%\n  filter(`status` == \"Active\")\nfree_meal_sites[, c(\"objectid\", \"phone_numb\", \"temporary_\", \"site_key\", \"website\", \"hours_mon_\", \"hours_tues\", \"hours_wed_\", \"hours_thur\", \"hours_fri_\", \"hours_sat_\", \"hours_sa_1\", \"hours_sa_2\", \"hours_sun_\", \"email\", \"seasonally\")] <- list(NULL)\n\ndrugs_2024[, c(\"the_geom\", \"cartodb_id\", \"the_geom_webmercator\", \"objectid\", \"dc_dist\", \"psa\", \"dispatch_date_time\", \"dispatch_date\", \"dispatch_time\", \"hour\", \"dc_key\", \"ucr_general\")] <- list(NULL)\n\nphilly_tracts[, c(\"STATEFP\", \"COUNTYFP\", \"GEOIDFQ\", \"NAME\", \"NAMELSAD\", \"STUSPS\", \"TRACTCE\", \"STATE_NAME\", \"LSAD\", \"TRACT\")] <- list(NULL)\ncolnames(philly_tracts)[2] <- \"county\"\n```\n:::\n\n\n**Questions to answer:**\n\n-   What dataset did you choose and why?\n\n    -   Aside from ACS data for PA's counties and census tracts, I chose\n        OpenDataPhilly's [crime incidence\n        data](https://opendataphilly.org/datasets/crime-incidents/),\n        [sharps drop boxes\n        data](https://opendataphilly.org/datasets/sharps-drop-boxes/),\n        [drug and alcohol treatment\n        facilities](https://opendataphilly.org/datasets/pa-drug-alcohol-treatment-facilities/),\n        and [free food program site\n        data](https://opendataphilly.org/datasets/free-food-sites/).\n        This is because I want to investigate the spatial overlap and\n        relationships with drug incidences and resources.\n\n-   What is the data source and date?\n\n    -   The crime data is from 2024, free meal sites from end of last\n        year, and facilities and sharps bins data are from end of\n        year 2023. All of these data had no official creation dates on\n        their pages, but the aforementioned years were observed from the\n        public GitHub repository. All data were extracted from\n        OpenDataPhilly's website.\n\n-   How many features does it contain?\n\n    -   The crime data has 160,388 features, free meals site data has\n        304 features, treatment facilities data has 965 features, and\n        sharps box data has 27 features.\n\n-   What CRS is it in? Did you need to transform it?\n\n    -   The crime data has no CRS but data having coordinates indicates\n        WGS84, free meals site data is in WGS84 / Pseudo-Mercator (EPSG\n        3857), treatment facilities is in WGS84 / World Geodetic System\n        1984 (EPSG 4326), and sharps box data is in WGS84 /\n        Pseudo-Mercator (EPSG 3857). Both the Philadelphia tract and\n        county data are in WGS84 / World Geodetic System 1984 (EPSG\n        4326). I made sure to transform all data to Pennsylvania South\n        (EPSG 3365) for calculations. For the crime data without the\n        CRS, I had to turn it into a geodataframe and change the CRS to\n        WGS84 first for that function, and then transform the CRS again\n        to Pennsylvania South.\n\n------------------------------------------------------------------------\n\n2.  **Pose a research question**\n\nWrite a clear research statement that your analysis will answer.\n\n-   Do tracts with high drug-related instances have adequate access to\n    treatment facilities, sharps bins, and free meal programs?\n\n------------------------------------------------------------------------\n\n3.  **Conduct spatial analysis**\n\nUse at least TWO spatial operations to answer your research question.\n\n**Required operations (choose 2+):**\n\n-   Buffers\n\n-   Spatial joins\\*\n\n-   Spatial filtering with predicates\\*\n\n-   Distance calculations\\*\n\n-   Intersections or unions\\*\n\n-   Point-in-polygon aggregation\\*\n\n**Your Task:**\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Aggregate and count drug offenses in Philadelphia census tracts.\n# Use pipe to input st_intersects return values into lengths() function.\nphilly_tracts$drug_offense <- st_intersects(philly_tracts, drugs_2024) |> lengths()\n\n# Normalize drug offense data by population total.\nphilly_tracts <- philly_tracts %>%\n  mutate(pct_drug_offense = case_when(\n    # Calculate as 0 when both values are 0.\n    total_popE == 0 & drug_offense == 0 ~ 0,\n    # Calculate as NA with numeric type rather than NA with logical type to avoid type mismatch.\n    total_popE == 0 ~ NA_real_,\n    # Otherwise, calculate normally.\n    TRUE ~ (drug_offense / total_popE) * 100\n  ))\n\n# Determine high drug offense tracts as above 50% of bell curve.\nphilly_tracts <- philly_tracts %>%\n  mutate(\"high_drug_offense\" = case_when(\n    .$pct_drug_offense > 0.20539 ~ TRUE,\n    TRUE ~ FALSE\n  ))\n\n# Filter tracts with drug offenses above the median.\ndrug_tracts <- philly_tracts %>%\n  filter(.$high_drug_offense == TRUE)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create census tract centroids for drug_tracts.\ndrug_centroids <- st_centroid(drug_tracts)\n\n# Calculate distances between centroids and food accessibility.\nnearest_meal_index <- st_nearest_feature(drug_centroids, free_meal_sites)\n\nnearest_meal_point <- free_meal_sites[nearest_meal_index,]\n\nmeal_distance <- st_distance(drug_centroids, nearest_meal_point, by_element = TRUE)\n\ndrug_tracts$nearest_meal_mi <- set_units(meal_distance, \"mi\")\n\n# Calculate distances between centroids and treatment facilities.\nnearest_facility_index <- st_nearest_feature(drug_centroids, treatment_facilities)\n\nnearest_facility_point <- treatment_facilities[nearest_facility_index,]\n\nfacility_distance <- st_distance(drug_centroids, nearest_facility_point, by_element = TRUE)\n\ndrug_tracts$nearest_facility_mi <- set_units(facility_distance, \"mi\")\n\n# Calculate distances between centroids and sharps bins.\nnearest_sharps_index <- st_nearest_feature(drug_centroids, sharps_boxes)\n\nnearest_sharps_point <- sharps_boxes[nearest_sharps_index,]\n\nsharps_distance <- st_distance(drug_centroids, nearest_sharps_point, by_element = TRUE)\n\ndrug_tracts$nearest_sharps_mi <- set_units(sharps_distance, \"mi\")\n\n# Determine how many tracts' nearest free meal program is more than 0.5 mi. away.\ntracts_lacking_meals <- sum(drug_tracts$nearest_meal_mi > set_units(0.5, \"mi\"))\n# Determine how many tracts' nearest treatment facility is more than 0.5 mi. away.\ntracts_lacking_facilities <- sum(drug_tracts$nearest_facility_mi > set_units(0.5, \"mi\"))\n# Determine how many tracts' nearest sharps bin is more than 0.5 mi. away.\ntracts_lacking_sharps <- sum(drug_tracts$nearest_sharps_mi > set_units(0.5, \"mi\"))\n\nprint(paste0(\"There are \", tracts_lacking_meals, \" census tracts that don't have active free meal programs within 0.5 mi. walking distance.\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"There are 6 census tracts that don't have active free meal programs within 0.5 mi. walking distance.\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(paste0(\"There are \", tracts_lacking_facilities, \" census tracts that don't have drug alcohol treatment facilities within 0.5 mi. walking distance.\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"There are 12 census tracts that don't have drug alcohol treatment facilities within 0.5 mi. walking distance.\"\n```\n\n\n:::\n\n```{.r .cell-code}\nprint(paste0(\"There are \", tracts_lacking_sharps, \" census tracts that don't have disposable sharps bins within 0.5 mi. walking distance.\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"There are 46 census tracts that don't have disposable sharps bins within 0.5 mi. walking distance.\"\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Map tracts more than 0.5 mile walking distance from free food programs.\nfar_from_meals_tracts <- drug_tracts %>%\n  mutate(nearest_meal_mi = drop_units(nearest_meal_mi)) %>%\n  filter(nearest_meal_mi > 0.5)\n\n# Transform geography data back to WGS84 for web mapping.\nfar_from_meals_tracts <- far_from_meals_tracts %>%\n  st_transform(crs = 4326)\n\n# Choropleth map colored by drug offenses with treatment facility points.\nfar_from_meals_choropleth <- ggplot(far_from_meals_tracts) +\n  geom_sf(\n    aes(fill = `pct_drug_offense`),\n  ) +\n  geom_sf(\n    data = philly_tracts, fill = NA,\n    color = \"black\", linewidth = 0.25,\n    alpha = 0.5\n  ) +\n  geom_point(\n    data = free_meal_sites,\n    aes(x = x, y = y, color = \"Free Meals\"),\n    alpha = 0.75, inherit.aes = FALSE\n  ) +\n  scale_fill_viridis_c(\n    name = \"Percent Drug Events\",\n    labels = function(x) paste0(x, \"%\")\n  ) +\n  scale_color_manual(\n    name = \"Free Meals\",\n    values = c(\"Free Meals\" = \"red2\")\n  ) +\n  labs(\n    title = \"HIGH DRUG EVENTS IN PHILADELPHIA, PA\",\n    subtitle = \"More than 0.5 mi from Free Meals\",\n    caption = \"Sources: 5-Year ACS 2023, OpenDataPhilly 2023–2025\",\n  ) +\n  theme_void()\n\nfar_from_meals_choropleth + theme(\n  panel.background = element_rect(fill = \"azure2\", size = 0.75),\n  legend.box.margin = margin(l = 10, unit = \"pt\"),\n  legend.title = element_text(face = \"bold\"),\n  legend.text = element_text(face = \"italic\"),\n  plot.title = element_text(face = \"bold\"),\n  plot.subtitle = element_text(margin = margin(b = 10, t = 5, unit = \"pt\")),\n  plot.caption = element_text(margin = margin(t = 10, unit = \"pt\"), face = \"italic\", family = \"mono\")\n)\n```\n\n::: {.cell-output-display}\n![](Vu_Tessa_Assignment2_files/figure-html/unnamed-chunk-19-1.png){width=1800}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Map tracts more than 0.5 mile walking distance from treatment facilities.\nfar_from_facilities_tracts <- drug_tracts %>%\n  mutate(nearest_facility_mi = drop_units(nearest_facility_mi)) %>%\n  filter(nearest_facility_mi > 0.5)\n\n# Transform geography data back to WGS84 for web mapping.\nfar_from_facilities_tracts <- far_from_facilities_tracts %>%\n  st_transform(crs = 4326)\n\n# Choropleth map colored by drug offenses with treatment facility points.\nfar_from_facilities_choropleth <- ggplot(far_from_facilities_tracts) +\n  geom_sf(\n    aes(fill = `pct_drug_offense`),\n  ) +\n  geom_sf(\n    data = philly_tracts, fill = NA,\n    color = \"black\", linewidth = 0.25,\n    alpha = 0.5\n  ) +\n  geom_point(\n    data = treatment_facilities,\n    aes(x = LONGITUDE, y = LATITUDE, color = \"Treatment Facilities\"),\n    alpha = 0.75, inherit.aes = FALSE\n  ) +\n  scale_fill_viridis_c(\n    name = \"Percent Drug Events\",\n    labels = function(x) paste0(x, \"%\")\n  ) +\n  scale_color_manual(\n    name = \"Treatment Facilities\",\n    values = c(\"Treatment Facilities\" = \"red2\")\n  ) +\n  labs(\n    title = \"HIGH DRUG EVENTS IN PHILADELPHIA, PA\",\n    subtitle = \"More than 0.5 mi from Treatment Facilities\",\n    caption = \"Sources: 5-Year ACS 2023, OpenDataPhilly 2023–2025\",\n  ) +\n  theme_void()\n\nfar_from_facilities_choropleth + theme(\n  panel.background = element_rect(fill = \"azure2\", size = 0.75),\n  legend.box.margin = margin(l = 10, unit = \"pt\"),\n  legend.title = element_text(face = \"bold\"),\n  legend.text = element_text(face = \"italic\"),\n  plot.title = element_text(face = \"bold\"),\n  plot.subtitle = element_text(margin = margin(b = 10, t = 5, unit = \"pt\")),\n  plot.caption = element_text(margin = margin(t = 10, unit = \"pt\"), face = \"italic\", family = \"mono\")\n)\n```\n\n::: {.cell-output-display}\n![](Vu_Tessa_Assignment2_files/figure-html/unnamed-chunk-20-1.png){width=1800}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Map tracts more than 0.5 mile walking distance from sharps bins.\nfar_from_sharps_tracts <- drug_tracts %>%\n  mutate(nearest_sharps_mi = drop_units(nearest_sharps_mi)) %>%\n  filter(nearest_sharps_mi > 0.5)\n\n# Align CRS.\nfar_from_sharps_tracts <- st_transform(far_from_sharps_tracts, 4326)\nsharps_boxes <- st_transform(sharps_boxes, 4326)\n\n# Extract coordinates from geometry to new columns for plotting.\nsharps_boxes <- sharps_boxes %>%\n  mutate(\n    lon = st_coordinates(geometry)[, 1],\n    lat = st_coordinates(geometry)[, 2]\n  )\n\n# Choropleth map colored by drug offenses with sharps bin points.\nsharps_choropleth <- ggplot(far_from_sharps_tracts) +\n  geom_sf(\n    aes(fill = `pct_drug_offense`),\n  ) +\n  geom_sf(\n    data = philly_tracts, fill = NA,\n    color = \"black\", linewidth = 0.25,\n    alpha = 0.5\n  ) +\n  geom_point(\n    data = sharps_boxes,\n    aes(x = lon, y = lat, color = \"Sharps Bins\"),\n    alpha = 0.75, inherit.aes = FALSE\n  ) +\n  scale_fill_viridis_c(\n    name = \"Percent Drug Events\",\n    labels = function(x) paste0(x, \"%\")\n  ) +\n  scale_color_manual(\n    name = \"Sharps Bins\",\n    values = c(\"Sharps Bins\" = \"red2\")\n  ) +\n  labs(\n    title = \"HIGH DRUG EVENTS IN PHILADELPHIA, PA\",\n    subtitle = \"More than 0.5 mi from Sharps Bins\",\n    caption = \"Sources: 5-Year ACS 2023, OpenDataPhilly 2023–2025\",\n  ) +\n  theme_void()\n\nsharps_choropleth + theme(\n  panel.background = element_rect(fill = \"azure2\", size = 0.75),\n  legend.box.margin = margin(l = 10, unit = \"pt\"),\n  legend.title = element_text(face = \"bold\"),\n  legend.text = element_text(face = \"italic\"),\n  plot.title = element_text(face = \"bold\"),\n  plot.subtitle = element_text(margin = margin(b = 10, t = 5, unit = \"pt\")),\n  plot.caption = element_text(margin = margin(t = 10, unit = \"pt\"), face = \"italic\", family = \"mono\")\n)\n```\n\n::: {.cell-output-display}\n![](Vu_Tessa_Assignment2_files/figure-html/unnamed-chunk-21-1.png){width=1800}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Align CRS.\ndrug_tracts <- st_transform(drug_tracts, 4326)\n\n# Choropleth map colored by drug offenses with sharps bin points and treatment facilities.\nall_choropleth <- ggplot(drug_tracts) +\n  geom_sf(\n    aes(fill = `pct_drug_offense`),\n  ) +\n  geom_sf(\n    data = philly_tracts, fill = NA,\n    color = \"azure2\", linewidth = 0.25,\n    alpha = 0.5\n  ) +\n  geom_point(\n    data = treatment_facilities,\n    aes(x = LONGITUDE, y = LATITUDE, color = \"Treatment Facilities\"),\n    alpha = 0.8, inherit.aes = FALSE\n  ) +\n  geom_point(\n    data = sharps_boxes,\n    aes(x = lon, y = lat, color = \"Sharps Bins\"),\n    alpha = 0.8, inherit.aes = FALSE\n  ) +\n  scale_fill_viridis_c(\n    name = \"Percent Drug Events\",\n    labels = function(x) paste0(x, \"%\")\n  ) +\n  scale_color_manual(\n    name = \"Harm Reduction\",\n    values = c(\"Treatment Facilities\" = \"orange\",\"Sharps Bins\" = \"red2\")\n  ) +\n  labs(\n    title = \"HIGH DRUG EVENTS IN PHILADELPHIA, PA\",\n    subtitle = \"With Sharps Bins and Treatment Facilities\",\n    caption = \"Sources: 5-Year ACS 2023, OpenDataPhilly 2023–2025\",\n  ) +\n  theme_void()\n\nall_choropleth + theme(\n  panel.background = element_rect(fill = \"azure4\", size = 0.75),\n  legend.box.margin = margin(l = 10, unit = \"pt\"),\n  legend.title = element_text(face = \"bold\"),\n  legend.text = element_text(face = \"italic\"),\n  plot.title = element_text(face = \"bold\"),\n  plot.subtitle = element_text(margin = margin(b = 10, t = 5, unit = \"pt\")),\n  plot.caption = element_text(margin = margin(t = 10, unit = \"pt\"), face = \"italic\", family = \"mono\")\n)\n```\n\n::: {.cell-output-display}\n![](Vu_Tessa_Assignment2_files/figure-html/unnamed-chunk-22-1.png){width=1800}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Summary statistics of data used.\n\ndata_used <- drug_tracts %>%\n  transmute(\n  \"GEOID\" = GEOID,\n  \"Population Estimate\" = total_popE,\n  \"Population MOE\" = total_popM,\n  \"Drug Incidence\" = drug_offense,\n  \"Percent Drug Incidence\" = pct_drug_offense,\n  \"Nearest Meal (mi)\" = nearest_meal_mi,\n  \"Nearest Facility (mi)\" = nearest_facility_mi,\n  \"Nearest Sharps (mi)\" = nearest_sharps_mi\n)\n\n# Align CRS.\ndata_used <- st_transform(data_used, 4326)\nfree_meal_sites <- st_transform(free_meal_sites, 4326)\nsharps_boxes <- st_transform(sharps_boxes, 4326)\ntreatment_facilities <- st_transform(treatment_facilities, 4326)\n\n# Only get geometry of point data.\nselected_meals <- free_meal_sites %>%\n  transmute(geometry)\n\nselected_sharps <- sharps_boxes %>%\n  select(geometry)\n\nselected_facilities <- treatment_facilities %>%\n  select(geometry)\n\n# Task is repetitive, so create a function to help with counting all the meal, facility, and sharps bin point data for each tract.\ncount_points <- function(point_data, tract_data, id = \"GEOID\", name = \"Count\"){\n  result <- point_data %>%\n    # Join using within predicate.\n    st_join(tract_data, join = st_within) %>%\n    # Drop point geometry to avoid duplication when joining back with tracts later.\n    st_drop_geometry() %>%\n    # Group by census tract GEOID.\n    group_by(.data[[id]]) %>%\n    # Count instances of points in each GEOID.\n    summarize(Count = n())\n  \n  # Change column name to user input name.\n  names(result)[names(result) == \"Count\"] <- name\n  \n  # Return the result.\n  result\n}\n\n# Use function on all point datasets.\nnumber_meals <- count_points(free_meal_sites, data_used, \"GEOID\", \"Number of Meals\")\nnumber_sharps <- count_points(sharps_boxes, data_used, \"GEOID\", \"Number of Sharps\")\nnumber_facilities <- count_points(treatment_facilities, data_used, \"GEOID\", \"Number of Facilities\")\n\n# Add counts back into tract data using left join.\ndata_used <- data_used %>%\n  left_join(number_meals, by = \"GEOID\") %>%\n  left_join(number_sharps, by = \"GEOID\") %>%\n  left_join(number_facilities, by = \"GEOID\") %>%\n  mutate(\n    # Fill empty cells with 0.\n    `Number of Meals` = replace_na(`Number of Meals`, 0),\n    `Number of Sharps` = replace_na(`Number of Sharps`, 0),\n    `Number of Facilities` = replace_na(`Number of Facilities`, 0)\n  )\n\n# Create dataframe from geodataframe for all data used.\ndata_used_df <- data_used %>%\n  st_drop_geometry() %>%\n  mutate(\n    GEOID = NULL\n  )\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# No scientific notation.\noptions(scipen = 999)\n\n# Tidy summary statistics for kable.\nsummary_stats <- data_used_df %>%\n  # Use map function to use summary function on each column,\n  # generating descriptive statistics for the values and storing in a dataframe.\n  map(summary) %>%\n  # Convert output list to tibble, tidying and stacking rows.\n  map_df(tidy) %>%\n  # Use original column names as variable values and place \"variable\" as the first column.\n  mutate(variable = names(data_used_df), .before = 1)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Kable of summary statistics.\nkable(\n  as.data.frame(summary_stats),\n  align = \"c\",\n  digit = 2,\n  format.args = list(big.mark = \",\"),\n  col.names = c(\"VARIABLE\", \"MIN\", \"Q1\", \"MEDIAN\", \"MEAN\", \"Q3\", \"MAX\"),\n  caption = \"<b>DRUG-RELATED DATA IN PHILADELPHIA, PA: Summary Statistics</b>\"\n) %>%\n  # Shade every other row for ease of reading.\n  kable_styling(bootstrap_options = \"striped\") %>%\n  column_spec(1, bold = TRUE) %>%\n  row_spec(0, color = \"white\", background = \"black\")\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped\" style=\"margin-left: auto; margin-right: auto;\">\n<caption><b>DRUG-RELATED DATA IN PHILADELPHIA, PA: Summary Statistics</b></caption>\n <thead>\n  <tr>\n   <th style=\"text-align:center;color: white !important;background-color: black !important;\"> VARIABLE </th>\n   <th style=\"text-align:center;color: white !important;background-color: black !important;\"> MIN </th>\n   <th style=\"text-align:center;color: white !important;background-color: black !important;\"> Q1 </th>\n   <th style=\"text-align:center;color: white !important;background-color: black !important;\"> MEDIAN </th>\n   <th style=\"text-align:center;color: white !important;background-color: black !important;\"> MEAN </th>\n   <th style=\"text-align:center;color: white !important;background-color: black !important;\"> Q3 </th>\n   <th style=\"text-align:center;color: white !important;background-color: black !important;\"> MAX </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> Population Estimate </td>\n   <td style=\"text-align:center;\"> 160.00 </td>\n   <td style=\"text-align:center;\"> 2,555.00 </td>\n   <td style=\"text-align:center;\"> 3,355.00 </td>\n   <td style=\"text-align:center;\"> 3,781.22 </td>\n   <td style=\"text-align:center;\"> 4,672.00 </td>\n   <td style=\"text-align:center;\"> 8,741.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> Population MOE </td>\n   <td style=\"text-align:center;\"> 11.00 </td>\n   <td style=\"text-align:center;\"> 465.00 </td>\n   <td style=\"text-align:center;\"> 773.00 </td>\n   <td style=\"text-align:center;\"> 776.06 </td>\n   <td style=\"text-align:center;\"> 905.00 </td>\n   <td style=\"text-align:center;\"> 1,943.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> Drug Incidence </td>\n   <td style=\"text-align:center;\"> 4.00 </td>\n   <td style=\"text-align:center;\"> 10.00 </td>\n   <td style=\"text-align:center;\"> 15.00 </td>\n   <td style=\"text-align:center;\"> 36.20 </td>\n   <td style=\"text-align:center;\"> 23.00 </td>\n   <td style=\"text-align:center;\"> 519.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> Percent Drug Incidence </td>\n   <td style=\"text-align:center;\"> 0.21 </td>\n   <td style=\"text-align:center;\"> 0.31 </td>\n   <td style=\"text-align:center;\"> 0.43 </td>\n   <td style=\"text-align:center;\"> 1.08 </td>\n   <td style=\"text-align:center;\"> 0.66 </td>\n   <td style=\"text-align:center;\"> 16.73 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> Nearest Meal (mi) </td>\n   <td style=\"text-align:center;\"> 0.02 </td>\n   <td style=\"text-align:center;\"> 0.12 </td>\n   <td style=\"text-align:center;\"> 0.18 </td>\n   <td style=\"text-align:center;\"> 0.23 </td>\n   <td style=\"text-align:center;\"> 0.25 </td>\n   <td style=\"text-align:center;\"> 1.57 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> Nearest Facility (mi) </td>\n   <td style=\"text-align:center;\"> 0.02 </td>\n   <td style=\"text-align:center;\"> 0.23 </td>\n   <td style=\"text-align:center;\"> 0.30 </td>\n   <td style=\"text-align:center;\"> 0.37 </td>\n   <td style=\"text-align:center;\"> 0.44 </td>\n   <td style=\"text-align:center;\"> 1.43 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> Nearest Sharps (mi) </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> 0.42 </td>\n   <td style=\"text-align:center;\"> 1.30 </td>\n   <td style=\"text-align:center;\"> 1.48 </td>\n   <td style=\"text-align:center;\"> 2.19 </td>\n   <td style=\"text-align:center;\"> 4.26 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> Number of Meals </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> 1.00 </td>\n   <td style=\"text-align:center;\"> 1.38 </td>\n   <td style=\"text-align:center;\"> 2.00 </td>\n   <td style=\"text-align:center;\"> 7.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> Number of Sharps </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> 0.31 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> 5.00 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:center;font-weight: bold;\"> Number of Facilities </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> 0.00 </td>\n   <td style=\"text-align:center;\"> 0.69 </td>\n   <td style=\"text-align:center;\"> 1.00 </td>\n   <td style=\"text-align:center;\"> 8.00 </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n**Analysis requirements:**\n\n-   Clear code comments explaining each step\n\n-   Appropriate CRS transformations\n\n-   Summary statistics or counts\n\n-   At least one map showing your findings\n\n-   Brief interpretation of results (3-5 sentences)\n\n**Your interpretation:**\n\nMany census tracts with higher percents of drug-related incidents lie in North Philly, Near-Northeast Philly, and West Philly primarily above Market Street. It seems like Philadelphia is taking the drug-related concerns seriously, the drug-alcohol treatment facilities and active free meal programs are peppered all around the county and have good coverage over tracts with higher drug-related events.\n\nIt also looks like most meals and facilities are within walking distance. However, sharps bins don't have too much spatial overlap and are lacking statistically, with average distances beyond a mile. It may be worth implementing more sharps bin sites around tracts with more drug-use events.\n\nWhile facilities may have disposals, many drug-users range from recreational to addicted and might fear arrest at facilities and even at sharps bins themselves, so it's important to address the issue without any demonizing, dehumanizing, and criminalizing.\n\nThis quick look at resource distribution has policy relevance to community investment, harm reduction, siting, food programming, and quality of life for everyone, not just those directly affected by drug-use.\n\n## Finally - A few comments about your incorporation of feedback!\n\n- I removed a lot of the extra instruction text in this write-up to make the report more concise and straightforward.\n- Any printouts and summaries created outside of kable were commented our or removed to give the report more clarity and not fill it with extra text or numbers.\n- I broke up long paragraphs when making any comments or analyses and shortened figure titles for readability.",
    "supporting": [
      "Vu_Tessa_Assignment2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"../../site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"../../site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}