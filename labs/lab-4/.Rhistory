)
# Scrollable Kable for neighborhoods
cv_results_neighborhoods %>%
arrange(desc(rmse)) %>%
mutate(
test_neighborhood = cell_spec(test_neighborhood, bold = TRUE),
mae = round(mae, 2),
rmse = round(rmse, 2)
) %>%
kable(
format = "html", # HTML formatting for visualization flexibility.
escape = FALSE,
caption = "Cross-Validation Results by Neighborhoods",
col.names = c("Neighborhood", "MAE", "RMSE"),
align = c("l", "c", "c"),
row.names = FALSE
) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed"), # Make the large Kable visually compact.
full_width = FALSE,
position = "center"
) %>%
row_spec(0, bold = TRUE, color = "white", background = "#21918c", align = "c") %>%
scroll_box(height = "500px", width = "500px") %>%  # Make it scrollable.
footnote(
general = paste0("Mean MAE: ", round(mean(cv_results_neighborhoods$mae), 2),
"\nMean RMSE: ", round(mean(cv_results_neighborhoods$rmse), 2)),
general_title = "Overall Performance:"
)
#| message: false
#| warning: false
#| fig-height: 10
#| fig-width: 12
#| fig-dpi: 300
# Join RMSE values to districts.
districts_rmse <- police_districts %>%
left_join(cv_results_districts,
by = c("dist_label" = "test_district"))
# Join RMSE values to neighborhoods.
neighborhoods_rmse <- neighborhoods %>%
left_join(cv_results_neighborhoods,
by = c("community" = "test_neighborhood"))
# Create custom color ramp.
weitzman <- colorRampPalette(c("#778ac5", "#ff4100"))
# District max and min RMSE for labeling.
district_max <- districts_rmse %>%
slice_max(rmse, n = 1)
district_min <- districts_rmse %>%
slice_min(rmse, n = 1)
# Neighborhood max and min RMSE for labeling.
neighborhood_max <- neighborhoods_rmse %>%
slice_max(rmse, n = 1)
neighborhood_min <- neighborhoods_rmse %>%
slice_min(rmse, n = 1)
# Police district RMSE.
rmse_districts <- ggplot(districts_rmse) +
geom_sf(aes(fill = rmse),
color = "#f5f4f0",
linewidth = 0.75
) +
scale_fill_gradientn(
colors = weitzman(256),
name = "Police District RMSE",
trans = "sqrt",
breaks = c(1.88, 2.79, 3.55, 3.98, 5.00, 6.99)
) +
geom_sf_label(
data = district_max,
aes(label = paste0(dist_label, ": ", round(rmse, 2))),
fill = "#2d2a26", color = "#f5f4f0", size = 3, label.size = 0,
fontface = "bold"
) +
geom_sf_label(
data = district_min,
aes(label = paste0(dist_label, ": ", round(rmse, 2))),
fill = "#2d2a26", color = "#f5f4f0", size = 3, label.size = 0,
fontface = "bold"
) +
labs(
title = "Police Districts",
subtitle = "Chicago, Illinois | Min and Max Districts"
) +
theme_chi_map() +
theme(
plot.background  = element_rect(fill = "#f5f4f0", color = NA),
panel.background = element_rect(fill = "#f5f4f0", color = NA)
)
# Neighborhood RMSE.
rmse_neighborhoods <- ggplot(neighborhoods_rmse) +
geom_sf(aes(fill = rmse),
color = "#f5f4f0",
linewidth = 0.75
) +
scale_fill_gradientn(
colors = weitzman(256),
name = "Neighborhood RMSE",
trans = "sqrt",
breaks = c(0.13, 1.93, 2.86, 3.90, 6.00, 11.40)
) +
geom_sf_label(
data = neighborhood_max,
aes(label = paste0(community, ": ", round(rmse, 2))),
fill = "#2d2a26", color = "#f5f4f0", size = 3, label.size = 0,
fontface = "bold"
) +
geom_sf_label(
data = neighborhood_min,
aes(label = paste0(community, ": ", round(rmse, 2))),
fill = "#2d2a26", color = "#f5f4f0", size = 3, label.size = 0,
fontface = "bold"
) +
labs(
title = "Neighborhoods",
subtitle = "Chicago, Illinois | Min and Max Neighborhoods"
) +
theme_chi_map() +
theme(
plot.background  = element_rect(fill = "#f5f4f0", color = NA),
panel.background = element_rect(fill = "#f5f4f0", color = NA)
)
# Combine plots using patchwork.
rmse_districts + rmse_neighborhoods +
plot_annotation(
title = "Spatial Distribution of LOGO Cross-Validation",
subtitle = "Root Mean Squared Error (RMSE)",
theme = theme(
plot.title = element_text(
size = 16,
face = "bold",
hjust = 0.5
),
plot.subtitle = element_text(
size = 14,
face = "italic",
hjust = 0.5,
color = "gray30"
),
plot.background  = element_rect(fill = "#f5f4f0", color = NA),
panel.background = element_rect(fill = "#f5f4f0", color = NA),
)
)
# Fit final model on all data.
final_model <- glm.nb(count_burglaries ~
# 311 data.
dist_to_hotspot_outages +
# Contextual count data.
count_vacant +
# Contextual spatial features.
dist_to_streets + building_density +
# Age polynomial.
avg_building_age + I(avg_building_age^2) +
# Zoning. Leave residential out as reference.
pct_Business_Commercial + pct_Downtown + pct_Industrial + pct_Park_Open_Space,
data = fishnet_model
)
# Add predictions back to fishnet.
fishnet <- fishnet %>%
mutate(
prediction_nb = predict(final_model, fishnet_model, type = "response")[match(uniqueID, fishnet_model$uniqueID)]
)
# Also add KDE predictions (normalize to same scale as counts).
kde_sum <- sum(fishnet$kde_value_burglaries, na.rm = TRUE)
count_sum <- sum(fishnet$count_burglaries, na.rm = TRUE)
fishnet <- fishnet %>%
mutate(
prediction_kde = (kde_value_burglaries / kde_sum) * count_sum
)
#| message: false
#| warning: false
#| fig-height: 8
#| fig-width: 12
#| fig-dpi: 300
# Create three maps.
actual_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = count_burglaries),
color = NA
) +
scale_fill_viridis_c(name = "Actual and Predicted Count",
option = "rocket",
direction = -1,
limits = c(0, 15)
) +
labs(title = "Actual Burglaries") +
theme_chi_map()
model_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = prediction_nb),
color = NA
) +
scale_fill_viridis_c(name = "Actual and Predicted Count",
option = "rocket",
direction = -1,
limits = c(0, 15)
) +
labs(title = "Model Predictions (Negative Binomial)") +
theme_chi_map()
kde_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = prediction_kde),
color = NA
) +
scale_fill_viridis_c(name = "Actual and Predicted Count",
option = "rocket",
direction = -1,
limits = c(0, 15)
) +
labs(title = "KDE Baseline Predictions") +
theme_chi_map()
actual_map + model_map + kde_map +
plot_annotation(
title = "Actual vs. Predicted Burglaries",
subtitle = "Performance: Negative Binomial vs. Simple KDE",
theme = theme(
plot.title = element_text(
size = 16,
face = "bold",
hjust = 0.5
),
plot.subtitle = element_text(
size = 14,
face = "italic",
hjust = 0.5,
color = "gray30"
)
)
) +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
# Calculate performance metrics.
comparison_2017 <- fishnet %>%
st_drop_geometry() %>%
filter(!is.na(prediction_nb), !is.na(prediction_kde)) %>%
summarize(
NB_MAE = mean(abs(count_burglaries - prediction_nb)),
NB_RMSE = sqrt(mean((count_burglaries - prediction_nb)^2)),
KDE_MAE = mean(abs(count_burglaries - prediction_kde)),
KDE_RMSE = sqrt(mean((count_burglaries - prediction_kde)^2))
)
# Create Kable.
comparison_2017 %>%
pivot_longer(everything(), names_to = "Metric", values_to = "Value") %>%
separate(Metric, into = c("Approach", "Metric"), sep = "_") %>%
pivot_wider(names_from = Metric, values_from = Value) %>%
kable(
format = "html", # HTML formatting for visualization flexibility.
escape = FALSE,
digits = 2,
caption = "Model In-Sample Performance Comparison (2017)",
align = c("l", "c", "c"),
row.names = FALSE
) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed"),
full_width = FALSE,
position = "center"
) %>%
row_spec(0, bold = TRUE, color = "white", background = "#21918c", align = "c") %>%
column_spec(1, bold = TRUE) %>%
footnote(
general = "Lower values are better.",
general_title = "Note:"
)
# Calculate performance metrics.
comparison_2018 <- fishnet %>%
st_drop_geometry() %>%
filter(!is.na(prediction_nb), !is.na(prediction_kde)) %>%
summarize(
NB_MAE = mean(abs(count_burglaries_2018 - prediction_nb)),
NB_RMSE = sqrt(mean((count_burglaries_2018 - prediction_nb)^2)),
KDE_MAE = mean(abs(count_burglaries_2018 - prediction_kde)),
KDE_RMSE = sqrt(mean((count_burglaries_2018 - prediction_kde)^2))
)
# Create Kable.
comparison_2018 %>%
pivot_longer(everything(), names_to = "Metric", values_to = "Value") %>%
separate(Metric, into = c("Approach", "Metric"), sep = "_") %>%
pivot_wider(names_from = Metric, values_from = Value) %>%
kable(
format = "html", # HTML formatting for visualization flexibility.
escape = FALSE,
digits = 2,
caption = "Model Out-of-Sample Performance Comparison (2018)",
align = c("l", "c", "c"),
row.names = FALSE
) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed"),
full_width = FALSE,
position = "center"
) %>%
row_spec(0, bold = TRUE, color = "white", background = "#21918c", align = "c") %>%
column_spec(1, bold = TRUE) %>%
footnote(
general = "Lower values are better.",
general_title = "Note:"
)
# Calculate errors.
fishnet <- fishnet %>%
mutate(
error_nb = count_burglaries - prediction_nb,
error_kde = count_burglaries - prediction_kde,
abs_error_nb = abs(error_nb),
abs_error_kde = abs(error_kde)
)
#| message: false
#| warning: false
#| fig-height: 12
#| fig-width: 12
#| fig-dpi: 300
# NB map errors.
nb_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = error_nb),
color = NA
) +
scale_fill_gradient2(
name = "Error",
low = "#2166ac", mid = "white", high = "#b2182b",
midpoint = 0,
limits = c(-10, 10),
breaks = c(-10, -5, 0, 5, 10)
) +
labs(title = "NB Model Errors (Actual – Predicted)") +
theme_chi_map()
# NB map absolute errors.
nb_abs_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = abs_error_nb),
color = NA
) +
scale_fill_viridis_c(name = "NB Absolute Error",
option = "rocket",
direction = -1,
breaks = c(0, 5, 10, 15, 20)
) +
labs(title = "NB Model Absolute Errors") +
theme_chi_map()
# KDE map errors.
kde_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = error_kde),
color = NA
) +
scale_fill_gradient2(
name = "Error",
low = "#2166ac", mid = "white", high = "#b2182b",
midpoint = 0,
limits = c(-10, 10),
breaks = c(-10, -5, 0, 5, 10)
) +
labs(title = "KDE Model Errors (Actual – Predicted)") +
theme_chi_map()
# KDE map absolute errors.
kde_abs_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = abs_error_kde),
color = NA
) +
scale_fill_viridis_c(name = "KDE Absolute Error",
option = "rocket",
direction = -1,
breaks = c(0, 5, 10, 15, 20)
) +
labs(title = "KDE Model Absolute Errors") +
theme_chi_map()
(nb_error_map + nb_abs_error_map) / (kde_error_map + kde_abs_error_map) +
plot_annotation(
title = "Model Errors",
subtitle = "Negative Binomial (NB) vs. Kernel Density Estimation (KDE)",
theme = theme(
plot.title = element_text(
size = 16,
face = "bold",
hjust = 0.5
),
plot.subtitle = element_text(
size = 14,
face = "italic",
hjust = 0.5,
color = "gray30"
)
)
) +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
#| message: false
#| warning: false
#| fig-height: 12
#| fig-width: 12
#| fig-dpi: 300
# NB map errors.
nb_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = error_nb),
color = NA
) +
scale_fill_gradient2(
name = "Error",
low = "#011f5b", mid = "white", high = "#990000",
midpoint = 0,
limits = c(-10, 10),
breaks = c(-10, -5, 0, 5, 10)
) +
labs(title = "NB Model Errors (Actual – Predicted)") +
theme_chi_map()
# NB map absolute errors.
nb_abs_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = abs_error_nb),
color = NA
) +
scale_fill_viridis_c(name = "NB Absolute Error",
option = "rocket",
direction = -1,
breaks = c(0, 5, 10, 15, 20)
) +
labs(title = "NB Model Absolute Errors") +
theme_chi_map()
# KDE map errors.
kde_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = error_kde),
color = NA
) +
scale_fill_gradient2(
name = "Error",
low = "#011f5b", mid = "white", high = "#990000",
midpoint = 0,
limits = c(-10, 10),
breaks = c(-10, -5, 0, 5, 10)
) +
labs(title = "KDE Model Errors (Actual – Predicted)") +
theme_chi_map()
# KDE map absolute errors.
kde_abs_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = abs_error_kde),
color = NA
) +
scale_fill_viridis_c(name = "KDE Absolute Error",
option = "rocket",
direction = -1,
breaks = c(0, 5, 10, 15, 20)
) +
labs(title = "KDE Model Absolute Errors") +
theme_chi_map()
(nb_error_map + nb_abs_error_map) / (kde_error_map + kde_abs_error_map) +
plot_annotation(
title = "Model Errors",
subtitle = "Negative Binomial (NB) vs. Kernel Density Estimation (KDE)",
theme = theme(
plot.title = element_text(
size = 16,
face = "bold",
hjust = 0.5
),
plot.subtitle = element_text(
size = 14,
face = "italic",
hjust = 0.5,
color = "gray30"
)
)
) +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
# Create final summary table.
model_summary <- broom::tidy(final_model, exponentiate = TRUE) %>%
mutate(
across(where(is.numeric), ~round(., 3))
)
# Rename to make the table more neat and professional.
model_summary <- model_summary %>%
mutate(term = case_when(
term == "(Intercept)" ~ "Intercept",
term == "I(avg_building_age^2)" ~ "Average Building Age²",
term == "count_vacant" ~ "Vacancy Count",
term == "dist_to_streets" ~ "Distance to Major Street",
term == "building_density" ~ "Building Density",
term == "I(avg_building_age^2)" ~ "Average Building Age²",
term == "avg_building_age" ~ "Average Building Age",
term == "pct_Business_Commercial" ~ "% Business/Commercial",
term == "pct_Downtown" ~ "% Downtown",
term == "pct_Industrial" ~ "% Industrial",
term == "pct_Park_Open_Space" ~ "% Park/Open Space",
term == "dist_to_hotspot_outages" ~ "Distance to Outage Hotspots",
TRUE ~ term
)
)
model_summary %>%
kable(
format = "html", # HTML formatting for visualization flexibility.
escape = FALSE,
digits = 2,
caption = "Final Negative Binomial Model Coefficients (Exponentiated)",
col.names = c("Variable", "Rate Ratio", "Standard Error", "Z-Score", "P-Value"),
align = c("l", rep("c", 4)),
row.names = FALSE
) %>%
kable_styling(bootstrap_options = c("striped", "hover", "condensed"),
full_width = FALSE,
position = "center"
) %>%
row_spec(0, bold = TRUE, color = "white", background = "#21918c", align = "c") %>%
column_spec(1, bold = TRUE) %>%
footnote(
general = "Rate Ratios > 1 have a positive association with burglary counts.",
general_title = "Note:"
)
---
title: "Critical Perspectives on Predictive Policing"
