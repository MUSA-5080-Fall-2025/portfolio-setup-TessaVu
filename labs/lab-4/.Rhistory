mutate(
prediction_nb = predict(final_model, fishnet_model, type = "response")[match(uniqueID, fishnet_model$uniqueID)]
)
# Also add KDE predictions (normalize to same scale as counts).
kde_sum <- sum(fishnet$kde_value_burglaries, na.rm = TRUE)
count_sum <- sum(fishnet$count_burglaries, na.rm = TRUE)
fishnet <- fishnet %>%
mutate(
prediction_kde = (kde_value_burglaries / kde_sum) * count_sum
)
#| message: false
#| warning: false
#| fig-height: 8
#| fig-width: 12
#| fig-dpi: 300
# Create three maps.
actual_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = count_burglaries),
color = NA
) +
geom_sf(data = chicago_boundary,
fill = NA,
color = "#21918c",
linewidth = 0.5
) +
scale_fill_viridis_c(name = "Actual and Predicted Count",
option = "rocket",
direction = -1,
limits = c(0, 15)
) +
labs(title = "Actual Burglaries") +
theme_chi_map()
model_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = prediction_nb),
color = NA
) +
geom_sf(data = chicago_boundary,
fill = NA,
color = "#21918c",
linewidth = 0.5
) +
scale_fill_viridis_c(name = "Actual and Predicted Count",
option = "rocket",
direction = -1,
limits = c(0, 15)
) +
labs(title = "Model Predictions (Negative Binomial)") +
theme_chi_map()
kde_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = prediction_kde),
color = NA
) +
geom_sf(data = chicago_boundary,
fill = NA,
color = "#21918c",
linewidth = 0.5
) +
scale_fill_viridis_c(name = "Actual and Predicted Count",
option = "rocket",
direction = -1,
limits = c(0, 15)
) +
labs(title = "KDE Baseline Predictions") +
theme_chi_map()
actual_map + model_map + kde_map +
plot_annotation(
title = "Actual vs. Predicted Burglaries",
subtitle = "Performance: Negative Binomial vs. Simple KDE",
theme = theme(
plot.title = element_text(
size = 16,
face = "bold",
hjust = 0.5
),
plot.subtitle = element_text(
size = 14,
face = "italic",
hjust = 0.5,
color = "gray30"
)
)
) +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
# Calculate performance metrics.
comparison_2017 <- fishnet %>%
st_drop_geometry() %>%
filter(!is.na(prediction_nb), !is.na(prediction_kde)) %>%
summarize(
NB_MAE = mean(abs(count_burglaries - prediction_nb)),
NB_RMSE = sqrt(mean((count_burglaries - prediction_nb)^2)),
KDE_MAE = mean(abs(count_burglaries - prediction_kde)),
KDE_RMSE = sqrt(mean((count_burglaries - prediction_kde)^2))
)
# Create Kable.
comparison_2017 %>%
pivot_longer(everything(), names_to = "Metric", values_to = "Value") %>%
separate(Metric, into = c("Approach", "Metric"), sep = "_") %>%
pivot_wider(names_from = Metric, values_from = Value) %>%
kable(
format = "html", # HTML formatting for visualization flexibility.
escape = FALSE,
digits = 2,
caption = "Model In-Sample Performance Comparison (2017)",
align = c("l", "c", "c"),
row.names = FALSE
) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed"),
full_width = FALSE,
position = "center"
) %>%
row_spec(0, bold = TRUE, color = "white", background = "#21918c", align = "c") %>%
column_spec(1, bold = TRUE) %>%
footnote(
general = "Lower values are better.",
general_title = "Note:"
)
# Calculate performance metrics.
comparison_2018 <- fishnet %>%
st_drop_geometry() %>%
filter(!is.na(prediction_nb), !is.na(prediction_kde)) %>%
summarize(
NB_MAE = mean(abs(count_burglaries_2018 - prediction_nb)),
NB_RMSE = sqrt(mean((count_burglaries_2018 - prediction_nb)^2)),
KDE_MAE = mean(abs(count_burglaries_2018 - prediction_kde)),
KDE_RMSE = sqrt(mean((count_burglaries_2018 - prediction_kde)^2))
)
# Create Kable.
comparison_2018 %>%
pivot_longer(everything(), names_to = "Metric", values_to = "Value") %>%
separate(Metric, into = c("Approach", "Metric"), sep = "_") %>%
pivot_wider(names_from = Metric, values_from = Value) %>%
kable(
format = "html", # HTML formatting for visualization flexibility.
escape = FALSE,
digits = 2,
caption = "Model Out-of-Sample Performance Comparison (2018)",
align = c("l", "c", "c"),
row.names = FALSE
) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed"),
full_width = FALSE,
position = "center"
) %>%
row_spec(0, bold = TRUE, color = "white", background = "#21918c", align = "c") %>%
column_spec(1, bold = TRUE) %>%
footnote(
general = "Lower values are better.",
general_title = "Note:"
)
# Calculate errors.
fishnet <- fishnet %>%
mutate(
error_nb = count_burglaries - prediction_nb,
error_kde = count_burglaries - prediction_kde,
abs_error_nb = abs(error_nb),
abs_error_kde = abs(error_kde)
)
#| message: false
#| warning: false
#| fig-height: 12
#| fig-width: 12
#| fig-dpi: 300
# NB map errors.
nb_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = error_nb),
color = NA
) +
scale_fill_gradient2(
name = "Error",
low = "#011f5b", mid = "white", high = "#990000",
midpoint = 0,
limits = c(-10, 10),
breaks = c(-10, -5, 0, 5, 10)
) +
labs(title = "NB Model Errors (Actual – Predicted)") +
theme_chi_map()
# NB map absolute errors.
nb_abs_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = abs_error_nb),
color = NA
) +
scale_fill_viridis_c(name = "NB Absolute Error",
option = "rocket",
direction = -1,
breaks = c(0, 5, 10, 15, 20)
) +
labs(title = "NB Model Absolute Errors") +
theme_chi_map()
# KDE map errors.
kde_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = error_kde),
color = NA
) +
scale_fill_gradient2(
name = "Error",
low = "#011f5b", mid = "white", high = "#990000",
midpoint = 0,
limits = c(-10, 10),
breaks = c(-10, -5, 0, 5, 10)
) +
labs(title = "KDE Model Errors (Actual – Predicted)") +
theme_chi_map()
# KDE map absolute errors.
kde_abs_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = abs_error_kde),
color = NA
) +
scale_fill_viridis_c(name = "KDE Absolute Error",
option = "rocket",
direction = -1,
breaks = c(0, 5, 10, 15, 20)
) +
labs(title = "KDE Model Absolute Errors") +
theme_chi_map()
(nb_error_map + nb_abs_error_map) / (kde_error_map + kde_abs_error_map) +
plot_annotation(
title = "Model Errors",
subtitle = "Negative Binomial (NB) vs. Kernel Density Estimation (KDE)",
theme = theme(
plot.title = element_text(
size = 16,
face = "bold",
hjust = 0.5
),
plot.subtitle = element_text(
size = 14,
face = "italic",
hjust = 0.5,
color = "gray30"
)
)
) +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
# Calculate performance metrics.
comparison_2017 <- fishnet %>%
st_drop_geometry() %>%
filter(!is.na(prediction_nb), !is.na(prediction_kde)) %>%
summarize(
NB_MAE = mean(abs(count_burglaries - prediction_nb)),
NB_RMSE = sqrt(mean((count_burglaries - prediction_nb)^2)),
KDE_MAE = mean(abs(count_burglaries - prediction_kde)),
KDE_RMSE = sqrt(mean((count_burglaries - prediction_kde)^2))
)
# Create Kable.
comparison_2017 %>%
pivot_longer(everything(), names_to = "Metric", values_to = "Value") %>%
separate(Metric, into = c("Approach", "Metric"), sep = "_") %>%
pivot_wider(names_from = Metric, values_from = Value) %>%
kable(
format = "html", # HTML formatting for visualization flexibility.
escape = FALSE,
digits = 2,
caption = "Model In-Sample Performance Comparison (2017)",
align = c("l", "c", "c"),
row.names = FALSE
) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed"),
full_width = FALSE,
position = "center"
) %>%
row_spec(0, bold = TRUE, color = "white", background = "#21918c", align = "c") %>%
column_spec(1, bold = TRUE) %>%
footnote(
general = "Lower values are better.",
general_title = "Note:"
)
# Calculate performance metrics.
comparison_2018 <- fishnet %>%
st_drop_geometry() %>%
filter(!is.na(prediction_nb), !is.na(prediction_kde)) %>%
summarize(
NB_MAE = mean(abs(count_burglaries_2018 - prediction_nb)),
NB_RMSE = sqrt(mean((count_burglaries_2018 - prediction_nb)^2)),
KDE_MAE = mean(abs(count_burglaries_2018 - prediction_kde)),
KDE_RMSE = sqrt(mean((count_burglaries_2018 - prediction_kde)^2))
)
# Create Kable.
comparison_2018 %>%
pivot_longer(everything(), names_to = "Metric", values_to = "Value") %>%
separate(Metric, into = c("Approach", "Metric"), sep = "_") %>%
pivot_wider(names_from = Metric, values_from = Value) %>%
kable(
format = "html", # HTML formatting for visualization flexibility.
escape = FALSE,
digits = 2,
caption = "Model Out-of-Sample Performance Comparison (2018)",
align = c("l", "c", "c"),
row.names = FALSE
) %>%
kable_styling(
bootstrap_options = c("striped", "hover", "condensed"),
full_width = FALSE,
position = "center"
) %>%
row_spec(0, bold = TRUE, color = "white", background = "#21918c", align = "c") %>%
column_spec(1, bold = TRUE) %>%
footnote(
general = "Lower values are better.",
general_title = "Note:"
)
# Calculate errors.
fishnet <- fishnet %>%
mutate(
error_nb = count_burglaries - prediction_nb,
error_kde = count_burglaries - prediction_kde,
abs_error_nb = abs(error_nb),
abs_error_kde = abs(error_kde)
)
#| message: false
#| warning: false
#| fig-height: 12
#| fig-width: 12
#| fig-dpi: 300
# NB map errors.
nb_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = error_nb),
color = NA
) +
scale_fill_gradient2(
name = "Error",
low = "#011f5b", mid = "white", high = "#990000",
midpoint = 0,
limits = c(-10, 10),
breaks = c(-10, -5, 0, 5, 10)
) +
geom_sf(data = chicago_boundary,
fill = NA,
color = "#21918c",
linewidth = 0.5
) +
labs(title = "NB Model Errors (Actual – Predicted)") +
theme_chi_map()
# NB map absolute errors.
nb_abs_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = abs_error_nb),
color = NA
) +
scale_fill_viridis_c(name = "NB Absolute Error",
option = "rocket",
direction = -1,
breaks = c(0, 5, 10, 15, 20)
) +
labs(title = "NB Model Absolute Errors") +
theme_chi_map()
# KDE map errors.
kde_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = error_kde),
color = NA
) +
geom_sf(data = chicago_boundary,
fill = NA,
color = "#21918c",
linewidth = 0.5
) +
scale_fill_gradient2(
name = "Error",
low = "#011f5b", mid = "white", high = "#990000",
midpoint = 0,
limits = c(-10, 10),
breaks = c(-10, -5, 0, 5, 10)
) +
labs(title = "KDE Model Errors (Actual – Predicted)") +
theme_chi_map()
# KDE map absolute errors.
kde_abs_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = abs_error_kde),
color = NA
) +
scale_fill_viridis_c(name = "KDE Absolute Error",
option = "rocket",
direction = -1,
breaks = c(0, 5, 10, 15, 20)
) +
labs(title = "KDE Model Absolute Errors") +
theme_chi_map()
(nb_error_map + nb_abs_error_map) / (kde_error_map + kde_abs_error_map) +
plot_annotation(
title = "Model Errors",
subtitle = "Negative Binomial (NB) vs. Kernel Density Estimation (KDE)",
theme = theme(
plot.title = element_text(
size = 16,
face = "bold",
hjust = 0.5
),
plot.subtitle = element_text(
size = 14,
face = "italic",
hjust = 0.5,
color = "gray30"
)
)
) +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
#| message: false
#| warning: false
#| fig-height: 12
#| fig-width: 12
#| fig-dpi: 300
# NB map errors.
nb_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = error_nb),
color = NA
) +
scale_fill_gradient2(
name = "Error",
low = "#011f5b", mid = "white", high = "#990000",
midpoint = 0,
limits = c(-10, 10),
breaks = c(-10, -5, 0, 5, 10)
) +
geom_sf(data = chicago_boundary,
fill = NA,
color = "#21918c",
linewidth = 0.5
) +
labs(title = "NB Model Errors (Actual – Predicted)") +
theme_chi_map()
# NB map absolute errors.
nb_abs_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = abs_error_nb),
color = NA
) +
geom_sf(data = chicago_boundary,
fill = NA,
color = "#21918c",
linewidth = 0.5
) +
scale_fill_viridis_c(name = "NB Absolute Error",
option = "rocket",
direction = -1,
breaks = c(0, 5, 10, 15, 20)
) +
labs(title = "NB Model Absolute Errors") +
theme_chi_map()
# KDE map errors.
kde_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = error_kde),
color = NA
) +
geom_sf(data = chicago_boundary,
fill = NA,
color = "#21918c",
linewidth = 0.5
) +
scale_fill_gradient2(
name = "Error",
low = "#011f5b", mid = "white", high = "#990000",
midpoint = 0,
limits = c(-10, 10),
breaks = c(-10, -5, 0, 5, 10)
) +
labs(title = "KDE Model Errors (Actual – Predicted)") +
theme_chi_map()
# KDE map absolute errors.
kde_abs_error_map <- ggplot() +
geom_sf(data = fishnet,
aes(fill = abs_error_kde),
color = NA
) +
geom_sf(data = chicago_boundary,
fill = NA,
color = "#21918c",
linewidth = 0.5
) +
scale_fill_viridis_c(name = "KDE Absolute Error",
option = "rocket",
direction = -1,
breaks = c(0, 5, 10, 15, 20)
) +
labs(title = "KDE Model Absolute Errors") +
theme_chi_map()
(nb_error_map + nb_abs_error_map) / (kde_error_map + kde_abs_error_map) +
plot_annotation(
title = "Model Errors",
subtitle = "Negative Binomial (NB) vs. Kernel Density Estimation (KDE)",
theme = theme(
plot.title = element_text(
size = 16,
face = "bold",
hjust = 0.5
),
plot.subtitle = element_text(
size = 14,
face = "italic",
hjust = 0.5,
color = "gray30"
)
)
) +
plot_layout(guides = "collect") &
theme(legend.position = "bottom")
