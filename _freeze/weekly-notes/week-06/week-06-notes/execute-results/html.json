{
  "hash": "00b1743a8e766de4b9c36498fb959f0c",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"WEEK 6 NOTES: SPATIAL MACHINE LEARNING & ADVANCED REGRESSION\"\ndate: \"2025-10-13\"\necho: FALSE\n---\n\n## Key Concepts Learned\n\n### Baseline Model\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.2     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.1.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\nLinking to GEOS 3.13.1, GDAL 3.11.0, PROJ 9.6.0; sf_use_s2() is TRUE\n\nhere() starts at C:/Users/Tess/Documents/GitHub/portfolio-setup-TessaVu/weekly-notes/week-06\n\nNew names:\nRows: 1485 Columns: 24\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (8): Style, R_AC, LU, OWN_OCC, R_BLDG_STY, R_ROOF_TYP, R_EXT_FIN, R_HEA...\ndbl (16): ...1, Parcel_No, SalePrice, PricePerSq, LivingArea, GROSS_AREA, NU...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 1,485\nColumns: 24\n$ ...1       <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, …\n$ Parcel_No  <dbl> 100032000, 100058000, 100073000, 100112000, 100137000, 1001…\n$ SalePrice  <dbl> 450000, 600000, 450000, 670000, 260000, 355000, 665000, 355…\n$ PricePerSq <dbl> 228.89, 164.34, 105.98, 291.94, 217.21, 190.96, 227.35, 120…\n$ LivingArea <dbl> 1966, 3840, 4246, 2295, 1197, 1859, 2925, 2904, 892, 1916, …\n$ Style      <chr> \"Conventional\", \"Semi?Det\", \"Decker\", \"Row\\xa0End\", \"Coloni…\n$ GROSS_AREA <dbl> 3111, 5603, 6010, 3482, 1785, 2198, 4341, 3892, 1658, 3318,…\n$ NUM_FLOORS <dbl> 2.0, 3.0, 3.0, 3.0, 2.0, 1.5, 3.0, 3.0, 2.0, 2.0, 1.5, 2.0,…\n$ R_BDRMS    <dbl> 4, 8, 9, 6, 2, 3, 8, 6, 2, 2, 4, 3, 3, 3, 6, 8, 4, 4, 3, 2,…\n$ R_FULL_BTH <dbl> 2, 3, 3, 3, 1, 3, 3, 3, 1, 2, 2, 3, 1, 1, 3, 3, 2, 3, 1, 2,…\n$ R_HALF_BTH <dbl> 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0,…\n$ R_KITCH    <dbl> 2, 3, 3, 3, 1, 2, 3, 3, 1, 2, 2, 3, 1, 1, 3, 3, 2, 3, 2, 2,…\n$ R_AC       <chr> \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\",…\n$ R_FPLACE   <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ LU         <chr> \"R2\", \"R3\", \"R3\", \"R3\", \"R1\", \"R2\", \"R3\", \"E\", \"R1\", \"R2\", …\n$ OWN_OCC    <chr> \"Y\", \"N\", \"Y\", \"N\", \"N\", \"N\", \"N\", \"N\", \"N\", \"Y\", \"N\", \"N\",…\n$ R_BLDG_STY <chr> \"CV\", \"SD\", \"DK\", \"RE\", \"CL\", \"CV\", \"DK\", \"DK\", \"RE\", \"TF\",…\n$ R_ROOF_TYP <chr> \"H\", \"F\", \"F\", \"F\", \"F\", \"G\", \"F\", \"F\", \"G\", \"F\", \"G\", \"F\",…\n$ R_EXT_FIN  <chr> \"M\", \"B\", \"M\", \"M\", \"P\", \"M\", \"M\", \"A\", \"A\", \"M\", \"W\", \"W\",…\n$ R_TOTAL_RM <dbl> 10, 17, 20, 14, 5, 8, 14, 14, 4, 9, 7, 7, 5, 5, 15, 14, 11,…\n$ R_HEAT_TYP <chr> \"W\", \"W\", \"W\", \"W\", \"E\", \"E\", \"W\", \"W\", \"W\", \"W\", \"W\", \"W\",…\n$ YR_BUILT   <dbl> 1900, 1910, 1910, 1905, 1860, 1905, 1900, 1890, 1900, 1900,…\n$ Latitude   <dbl> 42.37963, 42.37877, 42.37940, 42.38014, 42.37967, 42.37953,…\n$ Longitude  <dbl> -71.03076, -71.02943, -71.02846, -71.02859, -71.02903, -71.…\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = SalePrice ~ LivingArea, data = boston)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-855962 -219491  -68291   55248 9296561 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 157968.32   35855.59   4.406 1.13e-05 ***\nLivingArea     216.54      14.47  14.969  < 2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 563800 on 1483 degrees of freedom\nMultiple R-squared:  0.1313,\tAdjusted R-squared:  0.1307 \nF-statistic: 224.1 on 1 and 1483 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n- Interpretation\n  \n  - Intercept's Estimate: Base Sale Price at 0 sq. ft. is ~$157,968.32. Not useful in practice.\n  \n  - Living Area's Estimate: Each additional square foot of Living Area adds ~$216 to Sale Price.\n  \n  - Relationship is statistically significant (p < 0.001). If p is small, reject the null hypothesis.\n  \n  - R^2 is 0.13, so 13% of variation is explained by regression model output.\n  \n    - Most of the 87% variation is unexplained, so what's the problem?\n    \n      - Limitations\n      \n        - Ignores location (North End vs. Roxbury vs. Back Bay); proximity to downtown, waterfront, parks, etc.; nearby crime levels; school quality; neighborhood characteristics.\n        \n        - Might fail because 1,000 sq ft in Back Bay is not equivalent to 1,000 sq ft in Roxbury; same house, different locations, means very different prices; location!\n        \n        - Could improve by adding spatial features like crime and distance to amenities; control for neighborhood (fixed effects); include interactions (does size matter more in wealthy areas)?\n        \n        - Just doing a linear regression is a limit, so that's where spatial features come in.\n        \n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nlm(formula = SalePrice ~ LivingArea + R_FULL_BTH, data = boston)\n\nResiduals:\n    Min      1Q  Median      3Q     Max \n-783019 -230756  -65737   75367 9193133 \n\nCoefficients:\n             Estimate Std. Error t value Pr(>|t|)    \n(Intercept) 107683.96   37340.88   2.884  0.00399 ** \nLivingArea     145.68      21.33   6.828 1.25e-11 ***\nR_FULL_BTH  106978.13   23800.30   4.495 7.50e-06 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\nResidual standard error: 560200 on 1482 degrees of freedom\nMultiple R-squared:  0.1429,\tAdjusted R-squared:  0.1418 \nF-statistic: 123.6 on 2 and 1482 DF,  p-value: < 2.2e-16\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nBaseline R²: 0.1312636 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nWith bathrooms R²: 0.1429474 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 22 fields\nGeometry type: POINT\nDimension:     XY\nBounding box:  xmin: 238643.6 ymin: 903246 xmax: 238833.2 ymax: 903399.5\nProjected CRS: NAD_1983_HARN_StatePlane_Massachusetts_Mainland_FIPS_2001\n# A tibble: 6 × 23\n   ...1 Parcel_No SalePrice PricePerSq LivingArea Style    GROSS_AREA NUM_FLOORS\n  <dbl>     <dbl>     <dbl>      <dbl>      <dbl> <chr>         <dbl>      <dbl>\n1     1 100032000    450000       229.       1966 \"Conven…       3111        2  \n2     2 100058000    600000       164.       3840 \"Semi?D…       5603        3  \n3     3 100073000    450000       106.       4246 \"Decker\"       6010        3  \n4     4 100112000    670000       292.       2295 \"Row\\xa…       3482        3  \n5     5 100137000    260000       217.       1197 \"Coloni…       1785        2  \n6     6 100138000    355000       191.       1859 \"Conven…       2198        1.5\n# ℹ 15 more variables: R_BDRMS <dbl>, R_FULL_BTH <dbl>, R_HALF_BTH <dbl>,\n#   R_KITCH <dbl>, R_AC <chr>, R_FPLACE <dbl>, LU <chr>, OWN_OCC <chr>,\n#   R_BLDG_STY <chr>, R_ROOF_TYP <chr>, R_EXT_FIN <chr>, R_TOTAL_RM <dbl>,\n#   R_HEAT_TYP <chr>, YR_BUILT <dbl>, geometry <POINT [m]>\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"sf\"         \"tbl_df\"     \"tbl\"        \"data.frame\"\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 6 features and 7 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 229049.1 ymin: 890856 xmax: 236590.9 ymax: 900302.5\nProjected CRS: NAD_1983_HARN_StatePlane_Massachusetts_Mainland_FIPS_2001\n# A tibble: 6 × 8\n  sqmiles name         neighborhood_id  acres SHAPE__Length objectid SHAPE__Area\n    <dbl> <chr>        <chr>            <dbl>         <dbl>    <int>       <dbl>\n1    2.51 Roslindale   15              1606.         53564.       53   69938273.\n2    3.94 Jamaica Pla… 11              2519.         56350.       54  109737890.\n3    0.55 Mission Hill 13               351.         17919.       55   15283120.\n4    0.29 Longwood     28               189.         11909.       56    8215904.\n5    0.04 Bay Village  33                26.5         4651.       57    1156071.\n6    0.02 Leather Dis… 27                15.6         3237.       58     681272.\n# ℹ 1 more variable: geometry <MULTIPOLYGON [m]>\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] 26\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 19 × 2\n   name              n\n   <chr>         <int>\n 1 Dorchester      344\n 2 West Roxbury    242\n 3 Hyde Park       152\n 4 East Boston     149\n 5 Roslindale      142\n 6 Jamaica Plain   113\n 7 South Boston     80\n 8 Charlestown      65\n 9 Mattapan         65\n10 Roxbury          63\n11 South End        20\n12 Beacon Hill      17\n13 Mission Hill     14\n14 Allston           6\n15 Brighton          6\n16 Back Bay          3\n17 Fenway            2\n18 Bay Village       1\n19 Downtown          1\n```\n\n\n:::\n:::\n\n\n\n\n\n\n- Why do you think certain neighborhoods command higher prices? Proximity to downtown? Historical character? School quality? Safety? All of the above? This is why we need spatial features and neighborhood controls!\n\n### Part 1: Expanding Toolkit\n\n#### Categorical Variables\n\n- Continuous Variables\n\n  - Square footage\n  \n  - Age of house\n  \n  - Income levels\n  \n  - Distance to downtown\n  \n- Categorical Variables\n\n  - Neighborhood\n  \n    - **n-1 Rule:** One neighborhood is chosen as the reference category (omitted). R picks the first alphabetically unless specified otherwise.\n  \n  - School district\n  \n  - Building type\n  \n  - Has garage\n  \n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"Allston\"\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n                    Estimate   Std. Error    t value      Pr(>|t|)\n(Intercept)      704306.0751 9.022210e+04  7.8063584  1.112892e-14\nLivingArea          138.3206 6.468186e+00 21.3847638  1.605175e-88\nnameBack Bay    7525585.0560 1.533714e+05 49.0677253 1.522921e-311\nnameBay Village 1284057.5326 2.320256e+05  5.5341206  3.700442e-08\nnameBeacon Hill 1767805.2297 1.020211e+05 17.3278366  2.465874e-61\nnameBrighton    -168941.2113 1.239972e+05 -1.3624597  1.732623e-01\nnameCharlestown   -2556.8667 9.208989e+04 -0.0277649  9.778534e-01\nnameDorchester  -576819.4858 8.846990e+04 -6.5199517  9.653393e-11\nnameDowntown      58553.1237 2.322150e+05  0.2521505  8.009601e-01\nnameEast Boston -534060.4110 8.962950e+04 -5.9585340  3.182615e-09\n```\n\n\n:::\n:::\n\n\n- Interperetation\n\n  - **Reference Category:** Allston was automatically chosen as the intercept because it's the first alphabetically.\n  \n  - **Structural Variables**\n  \n    - **Living Area:** Each additional sq. ft. adds this amount (same for all neighborhoods).\n    \n    - **Bedrooms:** Effect of one or more full bathroom (same for all neighborhoods).\n    \n  - **Neighborhood Dummies**\n  \n    - **Positive Coefficient:** This neighborhood is *more* expensive than Allston.\n    \n    - **Negative Coefficient:** This neighborhood is *less* expensive than Allston.\n    \n    - All other variables constant and held equal, same size and same bathrooms.\n    \n      - House A in Back Bay\n      \n        - Living Area: 1,500 sq. ft.\n        \n        - Baths: 2\n        \n        - Neighborhood: Back Bay\n        \n        - Predicted Price: $8,458,873\n        \n      - House B in Roxbury\n      \n        - Living Area: 1,500 sq. ft.\n        \n        - Baths: 2\n        \n        - Neighborhood: Roxbury\n        \n        - Predicted Price: $311,066\n        \n      - Neighborhood Effect Price Difference: $8,127,807\n        \n        - Same house, different location, but huge price difference. This is what neighborhood dummies capture.\n        \n          - R automatically handles dummy variables as booleans, so 1 is true for Back Bay and 0 is false for Back Bay when creating neighborhood variables.\n  \n#### Interactions: When Relationships Depend\n\n- **The Question:** Doess the effect of one variable *depend on* the level of another variable?\n\n  - Example Scenarios\n  \n    - **Housing:** Does square footage matter more in wealthy neighborhoods?\n    \n    - **Education:** Do tutoring effects vary by initial skill level?\n    \n    - **Public Health:** Do pollution effects differ by age?\n    \n  - **Example for this study:** Is the value of square footage the same across all Boston neighborhoods?\n  \n    - SalePrice = β₀ + β₁(LivingArea) + β₂(WealthyNeighborhood) + β₃(LivingArea × WealthyNeighborhood) + ε\n    \n- **Theory: Luxury Premium Hypothesis**\n\n  - **In Wealthy Neighborhoods (Back Bay, Beacon Hill, South End)**\n  \n    - High-end buyers pay premium for space.\n    \n    - Luxury finishes, location prestige.\n    \n    - Each sq. ft. adds substantial value.\n    \n    - Steep slope.\n    \n    - **Hypothesis:** $300+ per sq. ft.\n    \n  - **In Working-Class Neighborhoods (Dorchester, Mattapan, East Boston)**\n  \n    - Buyers value function over luxury.\n    \n    - More price-sensitive market.\n    \n    - Space matters, but less premium.\n    \n    - Flatter slope.\n    \n    - **Hypothesis:** $100-150 per sq. ft.\n    \n  - **Key Question:** If we assume one slope for all neighborhoods, are we misunderstanding the market?\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 2 × 2\n  wealthy_neighborhood     n\n  <fct>                <int>\n1 Not Wealthy           1444\n2 Wealthy                 41\n```\n\n\n:::\n:::\n\n\nModel 1: No Interaction (Parallel Slopes)\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n                                Estimate   Std. Error   t value      Pr(>|t|)\n(Intercept)                  213842.7642 23893.619394  8.949785  1.039392e-18\nLivingArea                      160.2357     9.713346 16.496442  2.936087e-56\nwealthy_neighborhoodWealthy 2591012.0471 59958.794614 43.213211 1.103579e-264\n```\n\n\n:::\n:::\n\n\n- Assumes living area has the same effect in all neighborhoods. Only the intercept differs (wealthy areas start higher). Parallel lines on a plot.\n\nModel 2: With Interaction (Different Slopes)\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n                                            Estimate   Std. Error   t value\n(Intercept)                             358542.41696 1.863997e+04 19.235144\nLivingArea                                  95.63947 7.620382e+00 12.550483\nwealthy_neighborhoodWealthy            -377937.38372 1.005554e+05 -3.758498\nLivingArea:wealthy_neighborhoodWealthy     985.12500 2.975904e+01 33.103383\n                                            Pr(>|t|)\n(Intercept)                             8.875710e-74\nLivingArea                              2.079700e-34\nwealthy_neighborhoodWealthy             1.775774e-04\nLivingArea:wealthy_neighborhoodWealthy 2.445570e-180\n```\n\n\n:::\n:::\n\n\n- Allows living are to have different effects in different neighborhoods. Both intercept *and* slope differ. Non-parallel lines on a plot.\n\n- We get the un-intuitive negative premium here because that is an intercept adjustment (applies at 0 sqft). The slope difference (+985sq/ft) is huge - we can calculate when wealthy areas become more expensive at what sq. ft. = 384 (358,542 / 985).\n\n  - Not Wealthy Areas Equation: $Price = 358,542 + 96 × LivingArea$\n  \n    - Interpretation is at base price $358,542, each sq. ft. adds $96.\n  \n  - Wealthy Areas Equation: $Price = -19,395 + 1,081 × LivingArea$\n  \n    - Interpretation is at base price -$19,395, each sq. ft. adds $1,081.\n    \n  - The Interaction Effect. Wealthy areas value each sq ft $985 more than non-wealthy areas!\n\n- Key Observation: The lines are NOT parallel when plotted - that’s the interaction!\n\nComparing Model Performance\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nModel WITHOUT interaction R²: 0.6156 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nModel WITH interaction R²: 0.7791 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nImprovement: 0.1635 \n```\n\n\n:::\n:::\n\n\n- Model Improvement: Adding the interaction improves R² by 0.1635 (a 26.6% relative improvement)\n\n  - Interpretation: We explain 16.35% more variation in prices by allowing different slopes!\n\n#### Polynomial Terms: Non-Linear Relationships When Straight Lines Don't Fit\n\n- Signs of Non-Linearity:\n\n  - Curved residual plots.\n  \n  - Diminishing returns.\n  \n  - Accelerating effects.\n  \n  - U-shaped or inverted-U patterns.\n  \n  - Theoretical reasons.\n  \n- Examples:\n\n  - House Age: Depreciation, then vintage premium.\n  \n  - Test Scores: Plateau after studying.\n  \n  - Advertising: Diminishing returns.\n  \n  - Crime Prevention: Early gains, then plateaus.\n  \n- Polynomial Regression\n\n  - SalePrice = β₀ + β₁(Age) + β₂(Age²) + ε\n  \n    - Allows for *curved relationship*.\n    \n- Age's Non-Linear Effect\n\n  - New Houses (0-20 Years)\n  \n    - Modern amenities.\n    \n    - Move-in ready.\n    \n    - No repairs needed.\n    \n    - **High value.**\n    \n    - Steep depreciation initially.\n  \n  - Middle-Aged (20-80 Years)\n  \n    - Needs updates.\n    \n    - Wear and tear.\n    \n    - Not yet \"historic\".\n    \n    - **Lowest value.**\n    \n    - Trough of the curve.\n  \n  - Historic/Vintage (80+ Years)\n  \n    - Architectural character.\n    \n    - Historic districts.\n    \n    - Prestige value.\n    \n    - **Rising value.**\n    \n    - \"Vintage premium\".\n    \n- Boston's Context: The city has LOTS of historic homes (Back Bay, Beacon Hill built 1850s-1900s). Does age create a U-shaped curve?\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n   12.0    95.0   115.0   108.1   125.0   223.0 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](week-06-notes_files/figure-html/unnamed-chunk-22-1.png){width=672}\n:::\n:::\n\n\nLinear Model (Baseline)\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n                Estimate  Std. Error   t value     Pr(>|t|)\n(Intercept) -120808.8738 57836.98918 -2.088782 3.689911e-02\nAge            2834.0198   497.72013  5.694003 1.496246e-08\nLivingArea      202.8312    15.10373 13.429214 7.228187e-39\n```\n\n\n:::\n:::\n\n\n- Each additional year of age changes price by $2834.01 (assumed constant rate).\n\nAdd Polynomial Term: Age Squared\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n                Estimate   Std. Error   t value     Pr(>|t|)\n(Intercept) 570397.14406 97894.237962  5.826667 6.938345e-09\nAge         -13007.51918  1896.446156 -6.858892 1.019524e-11\nI(Age^2)        80.88988     9.360652  8.641479 1.425208e-17\nLivingArea     203.75007    14.739041 13.823835 5.975020e-41\n```\n\n\n:::\n:::\n\n\n- Important: The I() Function Why I(Age^2) instead of just Age^2? In R formulas, ^ has special meaning. I() tells R: “interpret this literally, compute Age²” Without I(): R would interpret it differently in the formula.\n\n- Model Equation: $Price = 570,397 + - 13,008 × Age + 80 × Age² + 204 × LivingArea$\n\n  - Warning: Can't interpret coefficients directly. With Age², the effect of age is no longer constant. You need to calculate the marginal effect. Marginal effect of $Age = β₁ + 2 × β₂ × Age$ This means the effect changes at every age!\n\nCompare Models\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nLinear model R²: 0.1549 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nQuadratic model R²: 0.1959 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nImprovement: 0.0409 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nAnalysis of Variance Table\n\nModel 1: SalePrice ~ Age + LivingArea\nModel 2: SalePrice ~ Age + I(Age^2) + LivingArea\n  Res.Df        RSS Df  Sum of Sq      F    Pr(>F)    \n1   1469 4.5786e+14                                   \n2   1468 4.3569e+14  1 2.2163e+13 74.675 < 2.2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n```\n\n\n:::\n:::\n\n\nCheck Residual Plot\n\n\n::: {.cell}\n::: {.cell-output-display}\n![](week-06-notes_files/figure-html/unnamed-chunk-29-1.png){width=672}\n:::\n:::\n\n\n### Part 2: Why Space Matters\n\n#### Hedonic Model Framework\n\n#### Tobler's First Law\n\n*“Everything is related to everything else, but near things are more related than distant things.”*\n\n*- Waldo Tobler, 1970*\n\n  - For house prices, crime nearby matters more than crime across the city.\n  \n  - Parks within walking distance affect value.\n  \n  - Immediate neighborhood defines market.\n\n#### Spatial Autocorrelation\n\n### Part 3: Creating Spatial Features\n\n#### Buffer Aggregation\n\n- **Count or sum** events within a defined distance.\n\n  - Example: Number of crimes within 500'.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `BPDA_Neighborhood_Boundaries' from data source \n  `C:\\Users\\Tess\\Documents\\GitHub\\portfolio-setup-TessaVu\\weekly-notes\\week-06\\data\\BPDA_Neighborhood_Boundaries.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 26 features and 7 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: -71.19125 ymin: 42.22792 xmax: -70.92278 ymax: 42.39699\nGeodetic CRS:  WGS 84\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nNew names:\nRows: 200977 Columns: 21\n── Column specification\n──────────────────────────────────────────────────────── Delimiter: \",\" chr\n(9): STREET, OFFENSE_DESCRIPTION, SHOOTING, DISTRICT, DAY_OF_WEEK, INC... dbl\n(11): ...1, OFFENSE_CODE, REPORTING_AREA, MONTH, HOUR, X_full_count, Lo... dttm\n(1): OCCURRED_ON_DATE\nℹ Use `spec()` to retrieve the full column specification for this data. ℹ\nSpecify the column types or set `show_col_types = FALSE` to quiet this message.\n• `` -> `...1`\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in CPL_crs_from_input(x): GDAL Message 1: EPSG:102286 is not a valid\nCRS code, but ESRI:102286 is. Assuming ESRI:102286 was meant\n```\n\n\n:::\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning in CPL_crs_from_input(x): GDAL Message 1: CRS EPSG:102286 is\ndeprecated. Its non-deprecated replacement EPSG:2805 will be used instead. To\nuse the original CRS, set the OSR_USE_NON_DEPRECATED configuration option to\nNO.\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n:::\n\n\n#### K-Nearest Neighbors\n\n- Average distance to k closest events.\n\n  - Example: **Average distance** to 3 nearest violent crimes.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n   crime_nn1         crime_nn3         crime_nn5      \n Min.   :  16.58   Min.   :  16.58   Min.   :  16.58  \n 1st Qu.: 299.19   1st Qu.: 331.19   1st Qu.: 382.47  \n Median : 585.10   Median : 611.03   Median : 679.62  \n Mean   : 757.88   Mean   : 791.84   Mean   : 857.06  \n 3rd Qu.:1043.77   3rd Qu.:1079.86   3rd Qu.:1174.81  \n Max.   :3558.73   Max.   :3558.73   Max.   :3630.10  \n```\n\n\n:::\n:::\n\n\n- crime_nn3 = 83.29 means the average distance to the 3 nearest crimes is 83.29 feet.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n           SalePrice\nSalePrice 1.00000000\ncrime_nn1 0.03267382\ncrime_nn3 0.03117884\ncrime_nn5 0.06963100\n```\n\n\n:::\n:::\n\n\n- Finding the kNN feature with the strongest correlation tells us the relevant “zone of influence” for crime perception!\n\n#### Distance to Specific Points\n\n- **Straight-line (Euclidian) distance** to important locations.\n\n  - Example: Distance to downtown, nearest T-Station.\n  \n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n   Min. 1st Qu.  Median    Mean 3rd Qu.    Max. \n0.05467 0.80476 1.37410 1.39107 1.93750 2.77678 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n crimes.Buffer    crimes_500ft     crime_nn3       dist_downtown_mi \n Min.   : 0.00   Min.   : 0.00   Min.   :  16.58   Min.   :0.05467  \n 1st Qu.: 0.00   1st Qu.: 0.00   1st Qu.: 331.19   1st Qu.:0.80476  \n Median : 3.00   Median : 0.00   Median : 611.03   Median :1.37410  \n Mean   : 7.78   Mean   : 4.49   Mean   : 791.84   Mean   :1.39107  \n 3rd Qu.: 9.00   3rd Qu.: 6.00   3rd Qu.:1079.86   3rd Qu.:1.93750  \n Max.   :75.00   Max.   :63.00   Max.   :3558.73   Max.   :2.77678  \n```\n\n\n:::\n:::\n\n\n- crimes.Buffer (660ft) is a buffer count measuring number of crimes near a house.\n\n- crimes_500ft is a buffer county measuring crimes within 500ft.\n\n- crime_nn3 is a kNN distance measuring average distance to 3 nearest crimes in feet.\n\n- dist_downtown_mi is a point distance measuring miles from downtown boston.\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nStructural R²: 0.2374 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nWith spatial R²: 0.3644 \n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nImprovement: 0.127 \n```\n\n\n:::\n:::\n\n\n### Part 4: Fixed Effects\n\n- Categorical variables that capture all unmeasured characteristics of a group.\n\n- In hedonic models:\n\n  - Each neighborhood gets its own dummy variable.\n  \n  - Captures everything unique about that neighborhood we didn't explicitly measure.\n  \n    - Technically done when went over categorical data.\n    \n    - What's captured:\n    \n      - School quality.\n      \n      - Prestige or reputation.\n      \n      - Walkability.\n      \n      - Access to jobs.\n      \n      - Cultural amenities.\n      \n      - **Things we can't easily measure.**\n    \n\n\n\n::: {.cell}\n\n:::\n\n\nEach coefficient is equal to the price premium/discount for that neighborhood (holding all else constant).\n\n- Why use fixed effects?\n\n  - Dramatically improves prediction.\n  \n    - In current data it's because neighborhoods bundle many unmeasured factors like school districts, job access, amenities, and \"cool factor\".\n    \n  - Coefficients change.\n  \n    - Crime coefficient without FE: -$125/crime\n    \n    - Crime coefficient with FE: -$85/crime\n    \n      - Without FE: Captured confounders too.\n      \n      - With FE: Neighborhoods \"absorb\" other differences.\n      \n      - Now just the crime effect.\n      \n    - Trade-Off: FEs are powerful, but they're a **black box**, we don't know **why** Back Bay commands a premium.\n    \nCompare All Models\n\n\n\n### Part 5: Cross-Validation with Categorical Variables\n\n#### CV Recap From Last Week\n\n- Three common validation approaches:\n\n  - **Train/Test Split:** 80/20 training/testing split, simple but unstable.\n  \n  - **k-Fold Cross-Validation:** Split into k-folds, train on k-1, test on 1, repeat.\n  \n  - **LOOCV:** Leave one observation out at a time (special case of k-fold).\n  \nUse k-fold CV to compare hedonic models.\n\n  - CV tells us how well model predicts new data.\n  \n  - More honest than in-sample R^2.\n  \n  - Helps detect overfitting.\n\n\n\n\n\n\n\n**Rule of Thumb:** Categories with n < 10 will likely cause CV problems.\n\n- Solution: Group small neighborhoods.\n\n\n\n  - Trade-Off: Lose granularity for small neighborhoods, but avoid CV crashes.\n\n- Alternative: Drop sparse categories.\n\n\n\n  - Warning: Consider carefully, which neighborhoods are you excluding? Often those with less data are marginalized communities. Document what you removed and why.\n\nRECOMMMENDED WORKFLOW\n\n\n\n\n\n\n\n- Note: These values are kind of ginormous - remember RMSE squares big errors, so outliers can have a really large impact.\n\n- Key Insight: Each layer improves out-of-sample prediction, with fixed effects providing the biggest boost.\n\n- Why? Neighborhoods bundle many unmeasured factors (schools, amenities, prestige) that we can’t easily quantify individually.\n\n- Look for: - Prices over $2-3 million (could be luxury condos or errors) - Prices near 0 (data errors) - Long right tail in histogram\n\n  - Log Transform the skewed dependent variable.\n  \n    - Interpreting log models:\n    \n      - RMSE is now in log-dollars (hard to interpret).\n      \n      - To convert back: exp(predictions) gives actual dollars.\n      \n      - Coefficients now represent percentage changes, not dollar changes.\n      \n      - This is standard practice in hedonic modeling!\n\n## Coding Techniques\n\n- sum(is.na())\n\n- glimpse()\n\n- summary()\n\n- st_drop_geometry()\n\n## Questions & Challenges\n\n- Do *NOT* use interactions when:\n\n  - There are small samples, sufficient data is needed in each group.\n  \n  - There are already too many interactions, it makes models unstable and causes overfitting.\n  \n- How do we quantify \"nearness\" in a way a regression model can use?\n\n  - Must creaate spaatial features that measure proximity to amenities/disamenities.\n  \n- When CV fails with categorical variables, the problem tends to be sparse categories.\n\n  - In example:\n  \n    - Random split created 10 folds.\n    \n    - All \"West End\" sales ended up in one fold, the test fold.\n    \n    - Training folds never saw \"West End\".\n    \n    - Model can't predict for a category it never learned.\n    \n  - Issue: When neighborhoods have very few sales (<10), random CV splits can put all instances in the saame fold, breaking the model.\n\n## Connections to Policy\n\n- Boston's Housing Market\n\n  - **Market Segmentation:** Boston operates as *two* distinct housing markets.\n  \n    - Luxury Market: Every sq. ft. is premium at $1,081/sq. ft.\n    \n    - Standard Market: Space is valued, but lower premium at $96 / sq. ft.\n    \n  - **Affordability Crisis:** The interaction amplifies inequality.\n  \n    - Large homes in wealthy areas become exponentially more expensive.\n    \n    - Creates barriers to mobility between neighborhoods.\n    \n  - **Policy Design:** One-size-fits-all policies likely will fail.\n  \n    - Property tax assessments should account for neighborhood-specific valuation.\n    \n    - Housing assistance needs vary dramatically by area.\n\n## Reflection\n\nTips for Success:\n\n- Do:\n\n  - Start simple, add complexity.\n  \n  - Check for NAs: sum(is.na()).\n  \n  - Test on small subset first.\n  \n  - Commment code.\n  \n  - Check coefficient signs.\n  \n  - Use glimpse() and summary().\n  \n- Don't:\n\n  - Add 50 variables at once.\n  \n  - Ignore errors.\n  \n  - Forget st_drop_geometry() for non-spatial operations.\n  \n  - Skip sparse category check.\n  \n- Common Errors:\n\n  - \"Factor has new levels\" -> Group sparse categories.\n  \n  - \"Computationally singular\" -> Remove collinear variables.\n  \n  - \"Very high RMSE\" -> Check outliers, scale.\n  \n  - \"CV takes forever\" -> Simplify model or reduce folds.\n  \n  - \"Negative R^2\" -> Model worse than mean, rethink variables.",
    "supporting": [
      "week-06-notes_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}