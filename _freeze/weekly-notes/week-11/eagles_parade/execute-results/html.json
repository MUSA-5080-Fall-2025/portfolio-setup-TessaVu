{
  "hash": "234514f8c2c05779bf1cfe38319e381f",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: EAGLES PARADE\nsubtitle: WEEK 11 NOTES\ndate: 2025-11-17\nauthor:\n  - name: Tess Vu\n    email:\n      - tessavu@proton.me\n      - tessavu@upenn.edu\n    corresponding: TRUE\naffiliation:\n  - name: University of Pennsylvania\n    department: Urban Spatial Analytics (MUSA)\n    city: Philadelphia\n    state: PA\n    url: https://www.design.upenn.edu/urban-spatial-analytics\nformat:\n  html:\n    code-fold: show\n    toc: true\n    toc-location: left\n    toc-expand: true\n    smooth-scroll: true\n    embed-resources: true\n    title-block-style: default\nexecute:\n  eval: false\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Libraries.\nlibrary(dplyr)\nlibrary(lubridate)\nlibrary(tidyverse)\n\nset.seed(42)\noptions(scipen = 999)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Bike data.\nindego <- read.csv(\"data/indego-trips-2025-q1.csv\", stringsAsFactors = FALSE)\n\n# Parse start_time with the correct format.\nindego <- indego %>%\n  mutate(\n    start_time = mdy_hm(start_time),# month/day/year hour:minute\n    interval60 = floor_date(start_time, \"hour\")\n  )\n\n# Aggregate to hourly counts per station.\nindego_hourly <- indego %>%\n  group_by(interval60, start_station) %>%\n  summarise(\n    Trip_Count = n(),\n    .groups = \"drop\"\n  )\n\n# Create train/test split.\nindego_hourly <- indego_hourly %>%\n  mutate(\n    week_num = week(interval60),\n    dotw_numeric = wday(interval60, label = FALSE),\n    dotw = wday(interval60, label = TRUE),\n    dotw_simple = ifelse(dotw %in% c(\"Sat\", \"Sun\"), \"Weekend\", \"Weekday\")\n  )\n\n# Split into train (weeks 1-9) and test (weeks 10-13).\ntrain <- indego_hourly %>% \n  filter(week_num <= 9)\n\ntest <- indego_hourly %>% \n  filter(week_num >= 10 & week_num <= 13)\n```\n:::\n\n\n# The Eagles Parade Problem: Temporal Validation vs. Rare Events\n\n## When Was the Parade?\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparade_date <- as.Date(\"2025-02-14\")\nparade_week <- week(parade_date)\n\ncat(\"ðŸ¦… Eagles Super Bowl Parade:\\n\")\ncat(\"  Date: February 14, 2025\\n\")\ncat(\"  Week of year:\", parade_week, \"\\n\\n\")\n\ncat(\"Our temporal split:\\n\")\ncat(\"  Training: weeks 1-9 (includes parade) âœ“\\n\")\ncat(\"  Test: weeks 10-13 (NO parade) âœ—\\n\\n\")\n```\n:::\n\n\n## Parade Feature to Training Data\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create a date column from interval60.\ntrain <- train %>%\n  mutate(\n    date = as.Date(interval60),\n    eagles_parade = ifelse(date == parade_date, 1, 0),\n    hour = hour(interval60)\n  )\n\ntest <- test %>%\n  mutate(\n    date = as.Date(interval60),\n    eagles_parade = 0, # No parade in test period.\n    hour = hour(interval60)\n  )\n\ncat(\"Parade indicator distribution:\\n\")\ncat(\"  Training set - parade day observations:\", sum(train$eagles_parade), \"\\n\")\ncat(\"  Test set - parade day observations:\", sum(test$eagles_parade), \"\\n\\n\")\n```\n:::\n\n\n## Fit Model with Parade Feature\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Baseline model.\nmodel1_baseline <- lm(\n  Trip_Count ~ as.factor(hour) + dotw_simple,\n  data = train\n)\n\n# Parade model.\nmodel1_parade <- lm(\n  Trip_Count ~ as.factor(hour) + dotw_simple + eagles_parade,\n  data = train\n)\n```\n:::\n\n\n## Show Coefficient\n\n\n::: {.cell}\n\n```{.r .cell-code}\nparade_coef <- summary(model1_parade)$coefficients[\"eagles_parade\", ]\ncat(\"Eagles Parade Coefficient (learned from training data):\\n\")\ncat(\"  Estimate:\", round(parade_coef[1], 3), \"trips per station-hour\\n\")\ncat(\"  p-value:\", format.pval(parade_coef[4], digits = 3), \"\\n\\n\")\n```\n:::\n\n\n## The Problem\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncat(\"âš ï¸  THE PROBLEM:\\n\")\ncat(\"We learned a parade effect from training data, but we CAN'T measure\\n\")\ncat(\"whether it generalizes because there's no parade in our test period!\\n\\n\")\n```\n:::\n\n\n## Test Set Performance Won't Change\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Generate predictions from both models.\ntest$pred1 <- predict(model1_baseline, newdata = test)  # Baseline (no parade)\ntest$pred1_parade <- predict(model1_parade, newdata = test)  # With parade feature\n\nmae_original <- mean(abs(test$Trip_Count - test$pred1), na.rm = TRUE)\nmae_with_parade <- mean(abs(test$Trip_Count - test$pred1_parade), na.rm = TRUE)\n\ncat(\"Test set MAE:\\n\")\ncat(\"  Without parade feature:\", round(mae_original, 3), \"\\n\")\ncat(\"  With parade feature:\", round(mae_with_parade, 3), \"\\n\")\ncat(\"  Difference:\", round(abs(mae_original - mae_with_parade), 4), \n    \"(essentially zero!)\\n\\n\")\n\ncat(\"Why no difference? Because test set has eagles_parade = 0 for all observations!\\n\")\ncat(\"The parade coefficient is learned but never 'activated' in test predictions.\\n\")\n```\n:::\n\n",
    "supporting": [
      "eagles_parade_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}